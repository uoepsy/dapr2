<!DOCTYPE html>
<html lang="en"><head>
<script src="dapr2_08_assump_diag_files/libs/clipboard/clipboard.min.js"></script>
<script src="dapr2_08_assump_diag_files/libs/quarto-html/tabby.min.js"></script>
<script src="dapr2_08_assump_diag_files/libs/quarto-html/popper.min.js"></script>
<script src="dapr2_08_assump_diag_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="dapr2_08_assump_diag_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="dapr2_08_assump_diag_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="dapr2_08_assump_diag_files/libs/quarto-html/quarto-syntax-highlighting-89ef1ee790bdc269b52a829279c5ce0e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="dapr2_08_assump_diag_files/libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.24">

  <meta name="author" content="Elizabeth Pankratz (elizabeth.pankratz@ed.ac.uk)">
  <title>Assumptions and diagnostics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="dapr2_08_assump_diag_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="dapr2_08_assump_diag_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #ca60ca; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="dapr2_08_assump_diag_files/libs/revealjs/dist/theme/quarto-53a9c49a12a3ad833bd88c7bb89b20b5.css">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-attribution/attribution.css" rel="stylesheet">
  <link href="dapr2_08_assump_diag_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(document).ready(function() {
      $('.cell').each(function() {
          let highlightLines = $(this).attr('data-output-line-numbers');
          if (highlightLines) {
              let lines = highlightLines.split(',').map(x => parseInt(x));
              $(this).find('.cell-output-stdout pre code').html(function(_, html) {
                  return html.split('\n').map((line, index) => {
                      if (lines.includes(index + 1)) {
                          return '<span style="background-color: #D0D8FC;">' + line + '</span>';
                      } else {
                          return line;
                      }
                  }).join('\n');
              });
          }
      });
  });
  </script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#BF1932" class="quarto-title-block center">
  <h1 class="title">Assumptions and diagnostics</h1>
  <p class="subtitle"><br>Data Analysis for Psychology in R 2</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Elizabeth Pankratz (elizabeth.pankratz@ed.ac.uk) 
</div>
        <p class="quarto-title-affiliation">
            <br>Department of Psychology<br>University of Edinburgh<br>2025–2026
          </p>
    </div>
</div>

</section>
<section>
<section id="course-overview" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Course Overview</h1>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<table style="border: 1px solid black;>
  <tr style=" padding:="" 0="" 1em="" 1em;"="">
    <tbody><tr><td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle">
        <b>Introduction to Linear Models</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Intro to Linear Regression</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Interpreting Linear Models</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Testing Individual Predictors</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Model Testing &amp; Comparison</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Linear Model Analysis</td></tr>

  <tr style="padding: 0 1em 0 1em;">
    <td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle">
        <b>Analysing Experimental Studies</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        Categorical Predictors &amp; Dummy Coding</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
            Effects Coding &amp; Coding Specific Contrasts</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1">
        <b>Assumptions &amp; Diagnostics</b></td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Bootstrapping</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
            Categorical Predictor Analysis</td></tr>
</tbody></table>
</div><div class="column" style="width:50%;">
<table style="border: 1px solid black;>
  <tr style=" padding:="" 0="" 1em="" 1em;"="">
    <tbody><tr><td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4;text-align:center;vertical-align: middle">
        <b>Interactions</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Interactions I</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Interactions II</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Interactions III</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Analysing Experiments</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Interaction Analysis</td></tr>

  <tr style="padding: 0 1em 0 1em;">
    <td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4;text-align:center;vertical-align: middle">
        <b>Advanced Topics</b></td>
    <td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Power Analysis</td>
  </tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Binary Logistic Regression I</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Binary Logistic Regression II</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
        Logistic Regression Analysis</td></tr>
  <tr><td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4">
            Exam Prep and Course Q&amp;A</td></tr>
</tbody></table>
</div></div>
</section>
<section id="this-weeks-learning-objectives" class="slide level2">
<h2>This week’s learning objectives</h2>
<p><br></p>
<div style="font-size: 125%;">
<div class="fragment">
<div class="dapr2callout">
<p>What does a linear model assume is true about the data that it models? (Four assumptions)</p>
</div>
</div>
<div class="fragment">
<div class="dapr2callout">
<p>What three properties of a single data point might affect a linear model’s estimates? How can we diagnose each property?</p>
</div>
</div>
<div class="fragment">
<div class="dapr2callout">
<p>What relationship between predictors do we want to avoid? How can we diagnose it?</p>
</div>
</div>
</div>
</section></section>
<section>
<section id="big-picture-why-does-a-model-make-assumptions" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Big picture: Why does a model make assumptions?</h1>

</section>
<section id="why-does-a-model-make-assumptions" class="slide level2">
<h2>Why does a model make assumptions?</h2>
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/gen-process.svg" class="quarto-figure quarto-figure-center" height="100"></p>
</figure>
</div>
<p><br></p>
<p>When we use any statistical model, we are saying <strong>“This model is the process that I think the world used to generate my data.”</strong></p>
<p><br></p>
<p><strong>Linear models are constrained in certain ways:</strong> for example, associations between predictors and outcomes can only be linear.</p>
<p><br></p>
<p>These constraints are the <strong>assumptions</strong> that the linear model makes about how the data was generated.</p>
</section></section>
<section>
<section id="assumptions" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Assumptions</h1>

</section>
<section id="what-a-linear-model-assumes-about-the-data" class="slide level2">
<h2>What a linear model assumes about the data</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Assumption</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>L</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Linearity:</strong> The association between predictor and outcome is a straight line.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="350"></td>
<td style="visibility: hidden"><img data-src="figs/nonlin.svg" width="350"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>I</strong></td>
<td style="visibility: hidden"><strong>Independence:</strong> Every data point's error is independent of every other data point's error. (Until DAPR3, we'll assume this is true as long as we have between-participant data.)</td>
<td style="visibility: hidden"></td>
<td style="visibility: hidden"></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>N</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Normally-distributed errors:</strong> The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/nonnorm.svg" width="150"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>E</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Equal variance of errors:</strong> The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/unequal.svg" width="150"></td>
</tr>
</tbody>
</table>
<p><!-- visibility: hidden; in style tag--></p>
</section></section>
<section>
<section id="l-is-for-linear-association" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>L is for linear association</h1>

</section>
<section id="l-the-association-between-predictor-and-outcome-is-linear" class="slide level2">
<h2><strong>L</strong>: The association between predictor and outcome is linear</h2>
<p><br></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20nonlin-1.svg" class="r-stretch"></section>
<section id="checking-linearity-with-one-predictor" class="slide level2">
<h2>Checking linearity with one predictor</h2>
<p>Make a scatterplot with a straight line and a “LOESS” line (<strong>LO</strong>cally <strong>E</strong>stimated <strong>S</strong>catterplot <strong>S</strong>moothing).</p>
<div class="fragment">
<div class="columns">
<div class="column" style="font-size: 85%;">
<p><strong>The linear variable:</strong></p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_nonlin <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>,</span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">'blue'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'loess'</span>,</span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">'red'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-4-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="font-size: 85%;">
<p><strong>The non-linear variable:</strong></p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_nonlin <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x2, <span class="at">y=</span>y)) <span class="sc">+</span></span>
<span id="cb2-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>,</span>
<span id="cb2-5"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">'blue'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'loess'</span>,</span>
<span id="cb2-7"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">'red'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-5-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>You want the LOESS line (<code>method = 'loess'</code>, red) to stick close to the straight line (<code>method = 'lm'</code>, blue). Deviations suggest non-linearity.</p>
</div>
</section>
<section id="checking-linearity-with-1-predictor" class="slide level2">
<h2>Checking linearity with &gt;1 predictor</h2>
<p><br></p>
<p>With multiple predictors, we need to get slightly more complex.</p>
<p>Now we to hold the other predictors constant while we look at each one in turn.</p>
<p><br></p>
<div class="fragment">
<p><strong>The solution: Component+residual plots</strong> (aka “partial-residual plots”).</p>
<ul>
<li><strong>Component:</strong> The association between one particular predictor and the outcome, with all the other predictors held constant.
<ul>
<li>In other words, each predictor’s contribution to the overall linear model.</li>
</ul></li>
<li><strong>Residual:</strong> The differences between the line the model predicts and the actual observed data points.</li>
</ul>
<p><br></p>
<p>Basically, CR plots can look at the linearity of each predictor without any of the other predictors getting in the way.</p>
</div>
</section>
<section id="checking-linearity-with-1-predictor-1" class="slide level2">
<h2>Checking linearity with &gt;1 predictor</h2>
<p>A component-residual plot shows:</p>
<ul>
<li><strong>x axis:</strong> a predictor across its full range</li>
<li><strong>y axis:</strong> that predictor’s component + each data point’s residual</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> df_nonlin)</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">crPlots</span>(m1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-7-1.svg" class="quarto-figure quarto-figure-center r-stretch"><p>Again, we want the LOESS line to match the straight line as closely as possible. Deviations suggest non-linearity.</p>
<p><strong>How much of a deviation is a problem?</strong> This is kind of a judgement call. Some deviation is normal.</p>
</section>
<section id="what-to-do-if-a-predictor-is-not-linear" class="slide level2">
<h2>What to do if a predictor is not linear</h2>
<p><br></p>
<p>In order of increasing spiciness:</p>
<p><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></p>
</div><div class="column" style="width:75%;">
<p>Keep the variable as-is and report the non-linearity in your write-up. A good solution if the deviation isn’t huge.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>Transform the variable until it looks more linear (e.g., what if you take the exponential with <code>exp()</code>? the logarithm with <code>log()</code>?)</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>Beyond DAPR3: You can use so-called “higher-order” regression terms, which let you model particular kinds of curves (quadratic functions, cubic functions, etc.).</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>Beyond DAPR3: You can capture basically any non-linear relationship using “generalised additive models” (GAMs).</p>
</div></div>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="what-a-linear-model-assumes-about-the-data-1" class="slide level2">
<h2>What a linear model assumes about the data</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Assumption</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>L</strong></td>
<td style="vertical-align: middle"><p><strong>Linearity:</strong> The association between predictor and outcome is a straight line.</p></td>
<td><img data-src="figs/assump-perf.svg" width="350"></td>
<td><img data-src="figs/nonlin.svg" width="350"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>I</strong></td>
<td style="visibility: hidden"><strong>Independence:</strong> Every data point's error is independent of every other data point's error. (Until DAPR3, we'll assume this is true as long as we have between-participant data.)</td>
<td style="visibility: hidden"></td>
<td style="visibility: hidden"></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>N</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Normally-distributed errors:</strong> The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/nonnorm.svg" width="150"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>E</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Equal variance of errors:</strong> The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/unequal.svg" width="150"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="i-is-for-independence-of-errors" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>I is for independence of errors</h1>

</section>
<section id="i-independence-of-errors" class="slide level2">
<h2><strong>I</strong>: Independence of errors</h2>
<p><br></p>
<!-- :::: {.columns} -->
<!-- ::: {.column width="50%"} -->
<!-- :::{.hcenter} -->
<!--  -->
<!-- ::: -->
<!-- <br> -->
<!-- **If you roll a 20-sided die at 9 am everyday,** you'll generate a lot of values between 1 and 20. -->
<!-- These values are totally unrelated to each other from one day to the next. -->
<!-- What you roll today is not correlated at all with the number you rolled yesterday. -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- :::{.hcenter} -->
<!--  -->
<!-- ::: -->
<!-- <br> -->
<!-- **If you take the temperature in Edinburgh at 9 am everyday,** you'll also generate values between 1 and 20 (ish). -->
<!-- These values *are* related to each other from one day to the next. -->
<!-- A colder temperature yesterday is more likely to go with a colder temperature today. -->
<!-- This is an example of **autocorrelation**. -->
<!-- ::: -->
<!-- :::: -->
<!-- ## To check for autocorrelation -->
<!-- ```{r include=F} -->
<!-- # simulate dice-rolling data -->
<!-- set.seed(2023) -->
<!-- acf_lo <- sample(1:20, size = 30, replace = TRUE) -->
<!-- # simulate autocorrelated data -->
<!-- # source: https://stackoverflow.com/a/77090029  -->
<!-- acf.negbin <- function(N, mu, size, alpha, max.iter = 100, tol = 1e-5) { -->
<!--   m = length(alpha) -->
<!--   generate = function(){ -->
<!--    x = sort(rnbinom(N,size=size,mu=mu)) -->
<!--    y <- rnorm(length(x)) -->
<!--    x[rank(stats::filter(y, alpha, circular = TRUE))] -->
<!--   } -->
<!--   a = generate() -->
<!--   iter <- 0L -->
<!--   ACF <- function(x) acf(x, lag.max = m - 1, plot = FALSE)$acf[1:m] -->
<!--   SSE <- function(x,alpha) sum((ACF(x) - alpha)^2) -->
<!--   while ((SSE0 <- SSE(a, alpha)) > tol) { -->
<!--     if ((iter <- iter + 1L) == max.iter) break -->
<!--     a1 <- generate() -->
<!--     if(SSE(a1,alpha) < SSE0) a <- a1 -->
<!--   } -->
<!--   return(a) -->
<!-- } -->
<!-- set.seed(2023) -->
<!-- acf_hi <- acf.negbin( -->
<!--   30,           # how many obs to simulate -->
<!--   mu = 10,      # mean of simulated data -->
<!--   size = 5,     # dispersion parameter.  -->
<!--                 # the bigger, the tighter the data will cluster around the mean. -->
<!--   alpha=c(0.9, 0.8, 0.8, 0.8)  # target correl of points with lag = 1, 2, n -->
<!--   ) -->
<!-- autocorr_data <- tibble( -->
<!--   day = 1:30, -->
<!--   d20 = acf_lo, -->
<!--   temp = acf_hi-3 -->
<!-- ) -->
<!-- ``` -->
<!-- :::: {.columns} -->
<!-- ::: {.column width="50%"} -->
<!-- :::{.hcenter} -->
<!--  -->
<!-- ::: -->
<!-- ```{r echo=F} -->
<!-- autocorr_data |> -->
<!--   ggplot(aes(x = day, y = d20)) + -->
<!--   geom_point(size = 5) + -->
<!--   geom_line(linewidth = 2) + -->
<!--   ylim(1, 20) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- :::{.hcenter} -->
<!--  -->
<!-- ::: -->
<!-- ```{r echo=F} -->
<!-- autocorr_data |> -->
<!--   ggplot(aes(x = day, y = temp)) + -->
<!--   geom_point(size = 5) + -->
<!--   geom_line(linewidth = 2) + -->
<!--   ylim(1, 20) -->
<!-- ``` -->
<!-- ::: -->
<!-- :::: -->
<!-- ## To check for autocorrelation -->
<!-- The **autocorrelation function** (ACF) quantifies how much each data point is correlated with each data point that came before it. -->
<!-- **Lag**: How many data points are we looking back by? -->
<!-- :::: {.columns} -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r fig.width=8, fig.asp = .7} -->
<!-- acf(autocorr_data$d20,  -->
<!--     cex.axis=1.7, cex.lab=1.6) -->
<!-- ``` -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- ```{r fig.width=8, fig.asp = .7} -->
<!-- acf(autocorr_data$temp,  -->
<!--     cex.axis=1.7, cex.lab=1.6) -->
<!-- ``` -->
<!-- ::: -->
<!-- :::: -->
<!-- This was an illustration using autocorrelated **data points**. -->
<!-- Strictly speaking, the linear model assumes that it's the **errors**, not the data points, that are independent—but where data points are autocorrelated, then often the errors are too. -->
<p>The most common source of non-independence is when multiple observations are gathered from the same source.</p>
<p><br></p>
<p>For example:</p>
<ul>
<li>many test scores gathered from the same schools,</li>
<li>many reaction times gathered from the same participants,</li>
<li>and so on.</li>
</ul>
<p><br></p>
<div class="dapr2callout fragment" style="font-size: 120%;">
<p><strong>Until DAPR3,</strong> you can assume that errors are independent <strong>as long as the experimental design is between-subjects</strong> (i.e., as long as each person only contributes data to one experimental condition).</p>
</div>
</section>
<section id="what-to-do-if-errors-are-non-independent" class="slide level2">
<h2>What to do if errors are non-independent</h2>
<p><br></p>
<p>In order of increasing spiciness:</p>
<p><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>Keep the variable as-is and report the non-independence in your write-up.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>In DAPR3, you’ll learn how to tell a model that some data points probably behave more like one another than they behave like others by including so-called “random effects”.</p>
</div></div>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="what-a-linear-model-assumes-about-the-data-2" class="slide level2">
<h2>What a linear model assumes about the data</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Assumption</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>L</strong></td>
<td style="vertical-align: middle"><strong>Linearity:</strong> The association between predictor and outcome is a straight line.</td>
<td><img data-src="figs/assump-perf.svg" width="350"></td>
<td><img data-src="figs/nonlin.svg" width="350"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>I</strong></td>
<td><strong>Independence:</strong> Every data point's error is independent of every other data point's error. (Until DAPR3, assume this is true as long as you have between-participant data.)</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>N</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Normally-distributed errors:</strong> The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/nonnorm.svg" width="150"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>E</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Equal variance of errors:</strong> The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/unequal.svg" width="150"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="n-is-for-normally-distributed-errors" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>N is for normally-distributed errors</h1>

</section>
<section id="n-normally-distributed-errors" class="slide level2">
<h2><strong>N</strong>: Normally-distributed errors</h2>
<p><br></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20beta-1.svg" class="r-stretch"><p>The differences between the fitted line and each data point (aka the <strong>residuals</strong>) should be normally-distributed.</p>
</section>
<section id="to-check-normality-of-errors" class="slide level2">
<h2>To check normality of errors</h2>
<p><br></p>
<p>Before there can be any residuals, there must be a fitted line.</p>
<p>So first, fit a model.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_norm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb4-2"><a href="" aria-hidden="true" tabindex="-1"></a>  y_norm <span class="sc">~</span> x, </span>
<span id="cb4-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_nonnorm</span>
<span id="cb4-4"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_nonnorm <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a>  y_nonnorm <span class="sc">~</span> x, </span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_nonnorm</span>
<span id="cb5-4"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
<p><br></p>
<p>Now we have a couple of options:</p>
<ol type="1">
<li><strong>A histogram of residuals</strong></li>
<li><strong>A Q-Q plot</strong></li>
</ol>
</section>
<section id="to-check-normality-of-errors-histogram" class="slide level2">
<h2>1. To check normality of errors: Histogram</h2>
<p><br></p>
<p>With a histogram of the residuals, we can eyeball how normally-distributed they appear.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Normally-distributed errors:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">residuals =</span> m_norm<span class="sc">$</span>residuals) <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> residuals)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-10-1.svg"></p>
</figure>
</div>
</div>
</div>
<p>Matches the bell curve shape pretty well.</p>
</div><div class="column" style="width:50%;">
<p><strong>Non-normally-distributed errors:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">residuals=</span>m_nonnorm<span class="sc">$</span>residuals) <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> residuals)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-11-1.svg"></p>
</figure>
</div>
</div>
</div>
<p>Very right-skewed! This is not a normal distribution.</p>
</div></div>
</section>
<section id="to-check-normality-of-errors-q-q-plots" class="slide level2">
<h2>2. To check normality of errors: Q-Q plots</h2>
<p>We can compare the model’s residuals to what the residuals WOULD look like in a world where they were perfectly normally-distributed.</p>
<p>This is what a “quantile-quantile plot”, a Q-Q plot, does. <strong>The dots should follow the diagonal line.</strong></p>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Normally-distributed errors:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m_norm, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-13-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
<p>A few small divergences at the extremes.</p>
</div><div class="column" style="width:50%;">
<p><strong>Non-normally-distributed errors:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m_nonnorm, <span class="at">which =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-15-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
<p>Bottom left and top right diverge a <em>lot</em>!</p>
</div></div>
<p>A perfect match to the diagonal is rare. Ask: <strong>How big is the mismatch?</strong></p>
</section>
<section id="what-to-do-if-errors-are-not-normal" class="slide level2">
<h2>What to do if errors are not normal</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><br></p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figs/dont-keep-calm.png" class="quarto-figure quarto-figure-center" width="350"></p>
</figure>
</div>
</div><div class="column" style="width:60%;">
<p>If errors aren’t normally distributed, then a model which assumes they <em>are</em> will produce weird (aka biased) estimates:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-16-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>Next week: we’ll learn how to get around this problem using a method called <strong>bootstrapping</strong>.</p>
<div class="hcenter fragment" style="font-size:125%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="what-a-linear-model-assumes-about-the-data-3" class="slide level2">
<h2>What a linear model assumes about the data</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Assumption</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>L</strong></td>
<td style="vertical-align: middle"><strong>Linearity:</strong> The association between predictor and outcome is a straight line.</td>
<td><img data-src="figs/assump-perf.svg" width="350"></td>
<td><img data-src="figs/nonlin.svg" width="350"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>I</strong></td>
<td><strong>Independence:</strong> Every data point's error is independent of every other data point's error. (Until DAPR3, assume this is true as long as you have between-participant data.)</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>N</strong></td>
<td style="vertical-align: middle"><strong>Normally-distributed errors:</strong> The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</td>
<td><img data-src="figs/assump-perf.svg" width="150"></td>
<td><img data-src="figs/nonnorm.svg" width="150"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>E</strong></td>
<td style="vertical-align: middle; visibility: hidden"><strong>Equal variance of errors:</strong> The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</td>
<td style="visibility: hidden"><img data-src="figs/assump-perf.svg" width="150"></td>
<td style="visibility: hidden"><img data-src="figs/unequal.svg" width="150"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="e-is-for-equal-variance-of-errors" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>E is for equal variance of errors</h1>

</section>
<section id="e-equal-variance-of-errors" class="slide level2">
<h2><strong>E</strong>: Equal variance of errors</h2>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20unequal-1.svg" class="r-stretch"><ul>
<li>Equal variance of errors is also called <strong>“homoscedasticity”</strong> (homo = same).</li>
<li>Unequal variance of errors is also called <strong>“heteroscedasticity”</strong> (hetero = different).</li>
</ul>
<p>When variance if errors is not equal, the model is not equally good at estimating the outcome for all values of the predictor.</p>
</section>
<section id="to-check-equal-variance-of-errors" class="slide level2">
<h2>To check equal variance of errors</h2>
<p><br></p>
<p>Again, to find the residuals—the differences between the fitted line and each data point—we need a fitted line.</p>
<p>So first, fit a model.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_equal <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a>  y_equal <span class="sc">~</span> x, </span>
<span id="cb10-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_unequal</span>
<span id="cb10-4"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_unequal <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb11-2"><a href="" aria-hidden="true" tabindex="-1"></a>  y_unequal <span class="sc">~</span> x, </span>
<span id="cb11-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_unequal</span>
<span id="cb11-4"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
<p><br></p>
<p><strong>Investigate by plotting the residuals against the predicted outcome values</strong> (also called the “fitted” values).</p>
</section>
<section id="to-check-equal-variance-of-errors-1" class="slide level2">
<h2>To check equal variance of errors</h2>
<p>A plot of residuals vs.&nbsp;predicted values shows:</p>
<ul>
<li><strong>x axis:</strong> the predicted outcome values (aka the “fitted values” across their whole range).</li>
<li><strong>y axis:</strong> the residuals of each data point.</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Errors with equal variance</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m_equal, <span class="at">which =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-20-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Errors with unequal variance</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m_unequal, <span class="at">which =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-22-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p><strong>What we want to see:</strong></p>
<ol type="1">
<li>A solid line which matches the horizontal dotted line, <strong>AND</strong></li>
<li>A random-looking cloud of data points</li>
</ol>
</section>
<section id="what-to-do-if-errors-dont-have-equal-variance" class="slide level2">
<h2>What to do if errors don’t have equal variance</h2>
<p><br></p>
<p>In order of increasing spiciness:</p>
<p><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>Keep the variable as-is and report the non-equal variance in your write-up.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></p>
</div><div class="column" style="width:75%;">
<p>Include additional predictors or interaction terms (more on interactions next semester). These <em>may</em> help account for some of that extra variance.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></p>
</div><div class="column" style="width:75%;">
<p>Use weighted least squares regression (WLS) instead of ordinary least squares (OLS). More details in this week’s flash cards.</p>
</div></div>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="what-a-linear-model-assumes-about-the-data-4" class="slide level2">
<h2>What a linear model assumes about the data</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Assumption</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>L</strong></td>
<td style="vertical-align: middle"><strong>Linearity:</strong> The association between predictor and outcome is a straight line.</td>
<td><img data-src="figs/assump-perf.svg" width="350"></td>
<td><img data-src="figs/nonlin.svg" width="350"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>I</strong></td>
<td><strong>Independence:</strong> Every data point's error is independent of every other data point's error. (Until DAPR3, assume this is true as long as you have between-participant data.)</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>N</strong></td>
<td style="vertical-align: middle"><strong>Normally-distributed errors:</strong> The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</td>
<td><img data-src="figs/assump-perf.svg" width="150"></td>
<td><img data-src="figs/nonnorm.svg" width="150"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>E</strong></td>
<td style="vertical-align: middle"><strong>Equal variance of errors:</strong> The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</td>
<td><img data-src="figs/assump-perf.svg" width="150"></td>
<td><img data-src="figs/unequal.svg" width="150"></td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="fragment">
<p>Checking assumptions is not an absolute science. It relies on intuitions and vibes (sorry!!)</p>
<p><strong><span class="math inline">\(\rightarrow\)</span> Look at the plots, motivate your reasoning, and you’ll be fine.</strong></p>
</div>
<!-- ================================================== -->
</section></section>
<section>
<section id="diagnostics" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Diagnostics</h1>

</section>
<section id="diagnostics-to-run-on-the-data" class="slide level2">
<h2>Diagnostics to run on the data</h2>
<p><br></p>
<div class="columns">
<div class="column" style="font-size: 125%;">
<p>Diagnosing unusual properties of <br> individual data points <br> (aka “case diagnostics”):</p>
<ol type="1">
<li>Outlyingness</li>
<li>High leverage</li>
<li>High influence</li>
</ol>
</div><div class="column" style="font-size: 125%;">
<p>Diagnosing undesirable relationships <br> between predictors:</p>
<ol type="1">
<li>Multicollinearity</li>
</ol>
</div></div>
</section></section>
<section>
<section id="outlyingness" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>1. Outlyingness</h1>

</section>
<section id="outlyingness-1" class="slide level2">
<h2>1. Outlyingness</h2>
<p>An <strong>outlier</strong> is a data point whose value for the outcome variable is unusually extreme.</p>
<p>The outcome is usually plotted on the y axis, so outliers are usually <strong>weird in the vertical direction (↕).</strong></p>
<p><br></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20outl-1.svg" class="r-stretch"><p>“Unusually extreme” <strong>for the model,</strong> not necessarily for the overall distribution of data!</p>
</section>
<section id="goal-find-unusually-big-residuals" class="slide level2">
<h2>Goal: Find unusually big residuals</h2>
<div class="dapr2callout fragment">
<p><strong>Residuals</strong> extracted from the linear model are on the scale of the outcome. For example:</p>
<ul>
<li><strong>Model A</strong> measures height in cm, so residuals are in cm.</li>
<li><strong>Model B</strong> measures log reaction time, so residuals are in log units.</li>
</ul>
<p>The scales of these residuals will be totally different. No single threshold for outliers will work for cm AND log units AND yards AND millions of pounds AND …</p>
</div>
<div class="hcenter fragment">
<p><span class="math inline">\(\downarrow\)</span></p>
</div>
<div class="dapr2callout fragment">
<p><strong>Standardised residuals</strong> convert residuals from their original scale into <strong>z-scores</strong>.</p>
<p>Now the residuals of Models A and B are on the same scale.</p>
<p>But to get <strong>z-scores</strong>, we compare each data point to the mean and SD of all data points.</p>
<p>The mean and SD will <em>be affected by</em> our potential outliers, so we’re slightly comparing a data point to itself.</p>
</div>
<div class="hcenter fragment">
<p><span class="math inline">\(\downarrow\)</span></p>
</div>
<div class="dapr2callout fragment">
<p><strong>Studentised residuals</strong> are a version of standardised residuals that exclude the specific data point we’re looking at.</p>
</div>
</section>
<section id="to-check-outlyingness-studentised-residuals" class="slide level2">
<h2>To check outlyingness: Studentised residuals</h2>
<p>You might recognise “Student” from “Student’s t-test”.</p>
<p>Studentised residuals are a kind of residual that follows a t-distribution.</p>
<p><br></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-23-1.svg" class="quarto-figure quarto-figure-center r-stretch"><div class="fragment">
<p>If you see data points with studentised residuals <strong>less than –2 or more than 2</strong>:</p>
<ul>
<li>you <em>might</em> have an outlier.</li>
<li>But also, 5% of the time, we would actually <em>expect</em> to have values outside of this range.</li>
</ul>
<p>A value less than –2 or more than 2 is a <strong>necessary but not sufficient condition.</strong></p>
<p><strong><span class="math inline">\(\rightarrow\)</span> The more extreme the studentised residual, the more likely it is that the data point is an outlier.</strong></p>
</div>
</section>
<section id="studentised-residuals-in-r" class="slide level2">
<h2>Studentised residuals in R</h2>
<p>Once we’ve fit a model, we can use the <code>rstudent()</code> function to get all the studentised residuals.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_outl <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_outl <span class="sc">~</span> x, <span class="at">data =</span> df_outl)</span>
<span id="cb14-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">rstudent</span>(m_outl) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1       2       3       4       5       6 
-0.0255  0.0261  0.2353 -0.3360  0.8212 -0.6834 </code></pre>
</div>
</div>
<p><br></p>
<div class="fragment">
<p>To plot the studentised residuals:</p>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-25-1.svg"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_outl<span class="sc">$</span>stud_resid <span class="ot">&lt;-</span> <span class="fu">rstudent</span>(m_outl)</span>
<span id="cb16-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="" aria-hidden="true" tabindex="-1"></a>df_outl <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> stud_resid)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span>  <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">'red'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">colour =</span> <span class="st">'red'</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br> <br></p>
<p><span class="math inline">\(\leftarrow\)</span> There’s our outlier!</p>
</div></div>
</div>
</section>
<section id="studentised-residuals-in-r-1" class="slide level2">
<h2>Studentised residuals in R</h2>
<p><br></p>
<p>To filter these residuals for the ones more extreme than <span class="math inline">\(\pm\)</span> 2:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_outl <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y_outl, stud_resid) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stud_resid <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">|</span> stud_resid <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 3
      x y_outl stud_resid
  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 -1.28   3.95       2.15
2  0.44   2.53      -2.24
3  1.76   1.24      -7.02
4  1.8    9.56       2.07</code></pre>
</div>
</div>
<p><br></p>
<p>We expected one outlier.</p>
<p>But it looks like we have four…?</p>
</section>
<section id="studentised-residuals-can-give-us-false-alarms" class="slide level2">
<h2>Studentised residuals can give us “false alarms”</h2>
<div class="columns">
<div id="good" class="column" style="width:50%;">
<p>Studentised residuals for the data without outliers:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-28-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div id="outl" class="column" style="width:50%;">
<p>Studentised residuals for the data with one outlier:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-29-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p>A value more extreme than <span class="math inline">\(\pm\)</span> 2 <strong>does not necessarily mean</strong> the data point is an outlier.</p>
<p>We would expect extreme values 5% of the time.</p>
<p><strong><span class="math inline">\(\rightarrow\)</span> The more extreme the studentised residual, the more likely it is that the data point is an outlier.</strong></p>
</section>
<section id="what-to-do-if-we-have-an-outlier" class="slide level2">
<h2>What to do if we have an outlier</h2>
<p><br></p>
<p>We’ll talk in detail about how to deal with unusual data points after we’ve looked at all three kinds.</p>
<p><br></p>
<p><strong>Preview:</strong></p>
<ul>
<li>Mention the unusual data points in the written analysis report.</li>
<li>Check if these data points affect the model’s estimates by running a sensitivity analysis.</li>
</ul>
<p><br></p>
<p>More on that in a bit!</p>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="diagnosing-unusual-data-points" class="slide level2">
<h2>Diagnosing unusual data points</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td><strong>Unusual property of a data point</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>1. Outlyingness:</strong> Unusual value of the outcome (↕), when compared to the model.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/outl.svg" width="200"></td>
</tr>
<tr class="odd" style="visibility:hidden;">
<td style="vertical-align: middle"><strong>2. High leverage:</strong> Unusual value of the predictor (↔︎), when compared to other predictor values.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/levg.svg" width="200"></td>
</tr>
<tr class="even" style="visibility:hidden;">
<td style="vertical-align: middle"><strong>3. High influence:</strong> High outlyingness and/or high leverage.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/infl.svg" width="200"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="high-leverage" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>2. High leverage</h1>

</section>
<section id="high-leverage-1" class="slide level2">
<h2>2. High leverage</h2>
<p>A data point with <strong>high leverage</strong> has an unusually extreme value for a predictor variable.</p>
<p>Predictors are usually plotted on the x axis, so high-leverage cases are usually <strong>weird in the horizontal direction (↔︎).</strong></p>
<p><br></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20levg-1.svg" class="quarto-figure quarto-figure-center r-stretch"><p>Can’t use residuals for high-leverage values, because residuals represent vertical (↕) distance.</p>
<p>Instead, for measuring horizontal (↔︎) distance: <strong>hat values</strong>.</p>
</section>
<section id="to-check-leverage-hat-values" class="slide level2">
<h2>To check leverage: Hat values</h2>
<p>Hat values <span class="math inline">\(h\)</span> are a standardised way of measuring how different a data point’s value is from other data points. (More mathy details are in the appendix of the slides.)</p>
<p><strong>Step 1:</strong> Compute the mean hat value <span class="math inline">\(\bar{h}\)</span> for a model with <span class="math inline">\(k\)</span> predictors and <span class="math inline">\(n\)</span> data points.</p>
<p><span class="math display">\[\bar{h} = \frac{k+1}{n}\]</span></p>
<p><strong>Heuristic (= rule of thumb) for high leverage:</strong> data points with hat values larger than <span class="math inline">\(2 \times \bar{h}\)</span>.</p>
<p><br></p>
<div class="fragment">
<p>For example, a model with one predictor (<span class="math inline">\(k=1\)</span>) and 104 observations (<span class="math inline">\(n=104\)</span>) has a mean hat value <span class="math inline">\(\bar{h}\)</span> of:</p>
<p><span class="math display">\[
\begin{align}
\bar{h} &amp;= \frac{k+1}{n} \\
\bar{h} &amp;= \frac{1+1}{104} \\
\bar{h} &amp;= \frac{2}{104} \\
\bar{h} &amp;\approx 0.0192
\end{align}
\]</span></p>
<p><strong>So our heuristic value for comparison is <span class="math inline">\(2 ~ \times\)</span> this number, so 0.0384.</strong></p>
</div>
</section>
<section id="to-check-leverage-hat-values-1" class="slide level2">
<h2>To check leverage: Hat values</h2>
<p><strong>Step 2:</strong> Let R compute the hat value <span class="math inline">\(h_i\)</span> for each individual data point <span class="math inline">\(i\)</span> using <code>hatvalues()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_levg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_levg <span class="sc">~</span> x, <span class="at">data =</span> df_levg)</span>
<span id="cb19-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">hatvalues</span>(m_levg) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1      2      3      4      5      6 
0.0369 0.0359 0.0348 0.0338 0.0328 0.0319 </code></pre>
</div>
</div>
<div class="fragment">
<p><strong>Step 3:</strong> Compare each data point’s hat values to the heuristic comparison value from Step 1.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the mean hat value </span></span>
<span id="cb21-2"><a href="" aria-hidden="true" tabindex="-1"></a>n_predictors <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb21-3"><a href="" aria-hidden="true" tabindex="-1"></a>n_observations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_levg)</span>
<span id="cb21-4"><a href="" aria-hidden="true" tabindex="-1"></a>(mean_hat <span class="ot">&lt;-</span> (n_predictors<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>n_observations)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0192</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Add hat values as column to df</span></span>
<span id="cb23-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_levg<span class="sc">$</span>hat <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(m_levg)</span>
<span id="cb23-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="" aria-hidden="true" tabindex="-1"></a>df_levg <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y_levg, hat) <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hat <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span>mean_hat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 3
      x y_levg    hat
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1   3.4   6.06 0.0845</code></pre>
</div>
</div>
</div>
</section>
<section id="to-plot-hat-values" class="slide level2">
<h2>To plot hat values</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">&lt;-</span> df_levg <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> hat)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span><span class="sc">*</span>mean_hat, <span class="at">colour =</span> <span class="st">'red'</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) </span>
<span id="cb25-5"><a href="" aria-hidden="true" tabindex="-1"></a>p_hat</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-33-1.svg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="hat-values-can-give-us-false-alarms" class="slide level2">
<h2>Hat values can give us “false alarms”</h2>
<p>But not this time! :)</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Hat values for the data without high-leverage cases:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-34-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Hat values for the data with one high-leverage case:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-35-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<div class="fragment">
<p><strong>Why are the dots curved?</strong></p>
<p>The curved shape happens because hat values measure distance from the mean of <strong>x</strong>.</p>
<p>The mean of <strong>x</strong> is 0, so all the data points on either side of 0 get bigger as they get farther away.</p>
</div>
<div class="hcenter fragment" style="font-size:125%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="diagnosing-unusual-data-points-1" class="slide level2">
<h2>Diagnosing unusual data points</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td><strong>Unusual property of a data point</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>1. Outlyingness:</strong> Unusual value of the outcome (↕), when compared to the model.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/outl.svg" width="200"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>2. High leverage:</strong> Unusual value of the predictor (↔︎), when compared to other predictor values.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/levg.svg" width="200"></td>
</tr>
<tr class="even" style="visibility:hidden;">
<td style="vertical-align: middle"><strong>3. High influence:</strong> High outlyingness and/or high leverage.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/infl.svg" width="200"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="high-influence" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>3. High influence</h1>

</section>
<section id="high-influence-1" class="slide level2">
<h2>3. High influence</h2>
<p>A data point with <strong>high influence</strong> has an unusually extreme value for the outcome variable <strong>and/or</strong> for a predictor variable. High influence points have the most potential to <strong>influence a linear model’s estimates.</strong></p>
<p>High-influence cases can be weird (relative to the model) <strong>in both the vertical direction (↕) and/or the horizontal direction (↔︎).</strong></p>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/fig%20infl-1.svg" class="quarto-figure quarto-figure-center r-stretch"><div class="fragment">
<p><strong>Two measures to diagnose high influence:</strong></p>
<ol type="1">
<li>Cook’s distance</li>
<li>COVRATIO</li>
</ol>
</div>
</section>
<section id="to-check-high-influence-cooks-distance" class="slide level2">
<h2>3.1. To check high influence: Cook’s distance</h2>
<p><br></p>
<p>Interpretation: <strong>the average distance that the predicted outcome values will move, if a given data point is removed.</strong></p>
<p><br></p>
<p>Cook’s distance is essentially <strong>outlyingness <span class="math inline">\(\times\)</span> leverage</strong> (mathy details in appendix).</p>
<p><br></p>
<table class="caption-top">
<tbody>
<tr class="odd">
<td>small outlyingness</td>
<td>x</td>
<td>small leverage</td>
<td>=</td>
<td>small influence</td>
</tr>
<tr class="even">
<td>small outlyingness</td>
<td>x</td>
<td><strong>BIG</strong> leverage</td>
<td>=</td>
<td><strong>BIG</strong> influence</td>
</tr>
<tr class="odd">
<td><strong>BIG</strong> outlyingness</td>
<td>x</td>
<td>small leverage</td>
<td>=</td>
<td><strong>BIG</strong> influence</td>
</tr>
<tr class="even">
<td><strong>BIG</strong> outlyingness</td>
<td>x</td>
<td><strong>BIG</strong> leverage</td>
<td>=</td>
<td><strong>VERY BIG</strong> influence</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="fragment">
<p><strong>A few possible threshold values for comparison:</strong></p>
<ul>
<li>1</li>
<li>4 divided by (sample size – number of predictors – 1) <strong><span class="math inline">\(~~~\leftarrow\)</span> we’ll use this one</strong></li>
<li>visually compare to the Cook’s distance values of other data points</li>
</ul>
</div>
</section>
<section id="to-check-high-influence-cooks-distance-1" class="slide level2">
<h2>3.1. To check high influence: Cook’s distance</h2>
<p><strong>Step 1:</strong> Compute the threshold value of Cook’s distance for our model and data: <br> <span class="math inline">\(n = 102\)</span> data points, <span class="math inline">\(k = 1\)</span> predictor.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>In maths:</strong></p>
<p><span class="math display">\[
\begin{align}
D &amp;= \frac{4}{n-k-1}\\
D &amp;= \frac{4}{102-1-1}\\
D &amp;= \frac{4}{100}\\
D &amp;= 0.04
\end{align}
\]</span></p>
</div><div class="column" style="width:50%;">
<p><strong>In R:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="" aria-hidden="true" tabindex="-1"></a>n_obs  <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_infl)</span>
<span id="cb26-2"><a href="" aria-hidden="true" tabindex="-1"></a>n_pred <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="" aria-hidden="true" tabindex="-1"></a>(D_threshold <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">/</span> (n_obs <span class="sc">-</span> n_pred <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04</code></pre>
</div>
</div>
</div></div>
<p><strong>Heuristic for high influence for THIS model:</strong> data points with Cook’s distance <span class="math inline">\(D\)</span> larger than 0.04.</p>
<p><br></p>
<div class="fragment">
<p><strong>Step 2:</strong> Let R compute the Cook’s distance <span class="math inline">\(D_i\)</span> for each data point using <code>cooks.distance()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_infl <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_infl <span class="sc">~</span> x, <span class="at">data =</span> df_infl)</span>
<span id="cb28-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(m_infl) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6 
0.0000198 0.0000109 0.0012139 0.0026703 0.0142310 0.0101705 </code></pre>
</div>
</div>
</div>
</section>
<section id="to-check-high-influence-cooks-distance-2" class="slide level2">
<h2>3.1. To check high influence: Cook’s distance</h2>
<p><strong>Step 3:</strong> Compare each data point’s <span class="math inline">\(D_i\)</span> to the heuristic comparison value from Step 1.</p>
<p><br></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Cook's distance as column to df</span></span>
<span id="cb30-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_infl<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(m_infl)</span>
<span id="cb30-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="" aria-hidden="true" tabindex="-1"></a>df_infl <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y_infl, D) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(D <span class="sc">&gt;</span> D_threshold)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 3
      x y_infl      D
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 -1.76  2.50  0.0499
2 -1.28  3.95  0.0578
3 -1.08  0.109 0.0404
4  1.8   9.56  0.0726
5 -1     6.5   0.165 </code></pre>
</div>
</div>
<p><br></p>
<p>We expected one high-influence value, but now we have five…?</p>
</section>
<section id="cooks-distance-can-give-us-false-alarms" class="slide level2">
<h2>Cook’s distance can give us “false alarms”</h2>
<div class="columns">
<div id="good" class="column" style="width:50%;">
<p><span class="math inline">\(D\)</span> for the data with no extreme high-influence values:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-39-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div id="outl" class="column" style="width:50%;">
<p><span class="math inline">\(D\)</span> for the data with one extreme high-influence value:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-40-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p><strong><span class="math inline">\(\rightarrow\)</span> The more extreme the Cook’s distance, the higher the influence of that data point.</strong></p>
<p><br></p>
<div class="fragment">
<p>Cook’s distance looks at how each data point influences the <strong>model predictions overall.</strong></p>
<p>The next measure, COVRATIO, looks at how each data point influences <strong>the regression coefficients (the slopes and intercepts).</strong></p>
</div>
</section>
<section id="to-check-high-influence-covratio" class="slide level2">
<h2>3.2. To check high influence: COVRATIO</h2>
<p>COVRATIO stands for “covariance ratio”.</p>
<p>Interpretation: <strong>how much a given data point affects the standard error (i.e., the variability) of the regression parameters.</strong></p>
<p>A ratio is a fraction that compares two values.</p>
<p><span class="math display">\[
\text{COVRATIO}_i = \frac{\text{a parameter's standard error, including data point}\ i}{\text{a parameter's standard error, NOT including data point}\ i}
\]</span></p>
<p><br></p>
<div class="fragment">
<p>If the given data point does not affect the standard error, then the ratio = 1.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>If the SE gets bigger without a data point:</p>
<p><span class="math display">\[
\frac
{\text{small SE with}\ i}
{\text{big SE without}\ i}
= \frac{\text{small}}{\text{big}}
&lt; 1
\]</span></p>
</div><div class="column" style="width:50%;">
<p>If the SE gets smaller without a data point:</p>
<p><span class="math display">\[
\frac
{\text{big SE with}\ i}
{\text{small SE without}\ i}
= \frac{\text{big}}{\text{small}}
&gt; 1
\]</span></p>
</div></div>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Threshold values</strong> for a model with <span class="math inline">\(k\)</span> parameters and <span class="math inline">\(n\)</span> data points:</p>
<ul>
<li>COVRATIO bigger than <span class="math inline">\(1+\frac{3(k + 1)}{n}\)</span></li>
<li>COVRATIO smaller than <span class="math inline">\(1-\frac{3(k + 1)}{n}\)</span></li>
</ul>
</div>
</section>
<section id="to-check-high-influence-covratio-1" class="slide level2">
<h2>3.2. To check high influence: COVRATIO</h2>
<p><strong>Step 1:</strong> Compute the COVRATIO threshold value for our model and data: <span class="math inline">\(n=102\)</span> data points, <span class="math inline">\(k=1\)</span> predictor.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>In maths (just the bit we add/subtract from 1):</strong></p>
<p><span class="math display">\[
\begin{align}
&amp; \frac{3(k + 1)}{n}\\
= &amp; \frac{3(1 + 1)}{102}\\
= &amp; \frac{3 \times 2}{102}\\
= &amp; \frac{6}{102}\\
= &amp; 0.059\\
\end{align}
\]</span></p>
</div><div class="column" style="width:50%;">
<p><strong>In R (the actual upper and lower bounds):</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="" aria-hidden="true" tabindex="-1"></a>n_obs  <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df_infl)</span>
<span id="cb32-2"><a href="" aria-hidden="true" tabindex="-1"></a>n_pred <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="" aria-hidden="true" tabindex="-1"></a>covr_upper <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> ((<span class="dv">3</span> <span class="sc">*</span> (n_pred <span class="sc">+</span> <span class="dv">1</span>))<span class="sc">/</span>n_obs)</span>
<span id="cb32-5"><a href="" aria-hidden="true" tabindex="-1"></a>covr_lower <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ((<span class="dv">3</span> <span class="sc">*</span> (n_pred <span class="sc">+</span> <span class="dv">1</span>))<span class="sc">/</span>n_obs)</span>
<span id="cb32-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(covr_lower, covr_upper)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.941 1.059</code></pre>
</div>
</div>
</div></div>
<p><br></p>
<p><strong>Heuristic for high influence for THIS model:</strong></p>
<ul>
<li>data points with COVRATIO larger than 1 + 0.059 = 1.059, <strong>OR</strong></li>
<li>data points with COVRATIO smaller than 1 – 0.059 = 0.941.</li>
</ul>
</section>
<section id="to-check-high-influence-covratio-2" class="slide level2">
<h2>3.2. To check high influence: COVRATIO</h2>
<p><strong>Step 2:</strong> Let R compute the COVRATIO for each data point using <code>covratio()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">covratio</span>(m_infl) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6 
1.06 1.06 1.06 1.05 1.04 1.04 </code></pre>
</div>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Step 3:</strong> Compare each data point’s COVRATIO to the heuristic comparison values from Step 1.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Add COVRATIO as column to df</span></span>
<span id="cb36-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_infl<span class="sc">$</span>covr <span class="ot">&lt;-</span> <span class="fu">covratio</span>(m_infl)</span>
<span id="cb36-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="" aria-hidden="true" tabindex="-1"></a>df_infl <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y_infl, covr) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(covr <span class="sc">&gt;</span> covr_upper <span class="sc">|</span> covr <span class="sc">&lt;</span> covr_lower)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 3
      x y_infl  covr
  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 -2     0.347 1.06 
2 -1.96  0.476 1.06 
3 -1.28  3.95  0.936
4  0.44  2.53  0.900
5  1.92  7.79  1.06 
6 -1     6.5   0.678</code></pre>
</div>
</div>
<p>Six values that affect the standard error of the regression parameters a lot!</p>
</div>
</section>
<section id="covratio-can-give-us-false-alarms" class="slide level2">
<h2>COVRATIO can give us “false alarms”</h2>
<div class="columns">
<div id="good" class="column" style="width:50%;">
<p>For the data with no extreme high-influence values:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-44-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div id="outl" class="column" style="width:50%;">
<p>For the data with one extreme high-influence value:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-45-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
<p><strong><span class="math inline">\(\rightarrow\)</span> The more extreme the COVRATIO, the higher the influence of that data point.</strong></p>
<!-- ================================================== -->
</section>
<section id="diagnosing-unusual-data-points-2" class="slide level2">
<h2>Diagnosing unusual data points</h2>
<table class="caption-top">
<tbody>
<tr class="odd">
<td><strong>Unusual property of a data point</strong></td>
<td><strong>Looks fine</strong></td>
<td><strong>Suspicious</strong></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>1. Outlyingness:</strong> Unusual value of the outcome (↕), when compared to the model.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/outl.svg" width="200"></td>
</tr>
<tr class="odd">
<td style="vertical-align: middle"><strong>2. High leverage:</strong> Unusual value of the predictor (↔︎), when compared to other predictor values.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/levg.svg" width="200"></td>
</tr>
<tr class="even">
<td style="vertical-align: middle"><strong>3. High influence:</strong> High outlyingness and/or high leverage.</td>
<td><img data-src="figs/perf.svg" width="200"></td>
<td><img data-src="figs/infl.svg" width="200"></td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="one-function-for-most-data-point-diagnostics" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>One function for most data point diagnostics</h1>

</section>
<section id="one-function-for-most-data-point-diagnostics-1" class="slide level2">
<h2>One function for most data point diagnostics</h2>
<p><code>influence.measures()</code> computes all the data point diagnostics we’ve talked about <br> (except studentised residuals for outlyingness).</p>
<p><br></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">influence.measures</span>(m_infl)<span class="sc">$</span>infmat <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  dfb.1_  dfb.x  dffit cov.r cook.d   hat
1 -0.003  0.005 -0.006  1.06  0.000 0.038
2  0.002 -0.004  0.005  1.06  0.000 0.037
3  0.025 -0.042  0.049  1.06  0.001 0.036
4 -0.038  0.062 -0.073  1.05  0.003 0.035
5  0.089 -0.142  0.169  1.04  0.014 0.034
6 -0.077  0.119 -0.142  1.04  0.010 0.033</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><code>dfb.1_</code>: difference between the predicted values for the intercept with and without this data point</li>
<li><code>dfb.x</code> aka “dfbeta”: difference between the predicted values for a predictor’s slope with and without this data point (there will be one of these measures per predictor)</li>
<li><code>dffit</code>: difference between predicted outcome values with and without this data point</li>
<li><code>cov.r</code>: covariance ratio of regression parameters with and without this data point</li>
<li><code>cook.d</code>: Cook’s Distance of this data point</li>
<li><code>hat</code>: hat value of this data point</li>
</ul>
</section>
<section id="vote-what-to-do-if-you-find-unusual-data-points" class="slide level2">
<h2>Vote: What to do if you find unusual data points</h2>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Ignore them and pretend they don’t exist?</p>
</div>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Check if they could be a mistake?</p>
</div>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Delete them?</p>
</div>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Mention them in your write-up?</p>
</div>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Replace them with less extreme values?</p>
</div>
<p><br></p>
<div class="fragment">
<p><img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsup-filled.svg"> <img style="vertical-align: text-bottom; width: 1.5em;" src="figs/codicon--thumbsdown-filled.svg"> &nbsp; &nbsp; Check how much they influence your conclusions?</p>
</div>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section></section>
<section>
<section id="sensitivity-analysis" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Sensitivity analysis</h1>

</section>
<section id="sensitivity-analysis-1" class="slide level2">
<h2>Sensitivity analysis</h2>
<p>A sensitivity analysis asks: <strong>Do our conclusions change if we leave out the unusual data point(s)?</strong></p>
<ul>
<li>If our conclusions don’t change, then the data points don’t matter too much.</li>
<li>If our conclusions DO change, then we need to report that as a big limitation of our analysis.</li>
</ul>
<p><br></p>
<p><strong>Example 1:</strong></p>
<p>Imagine we want to know whether there’s a significant positive association between <strong>x</strong> and <strong>y</strong>, but there’s a data point that we suspect might have high influence on our model.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>One high-influence data point?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-47-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>We try removing that data point to see what happens.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-48-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="sensitivity-analysis-2" class="slide level2">
<h2>Sensitivity analysis</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>A model fit to the data that contains <br> the high-influence value:</p>
<div style="font-size: 80%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_infl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_infl ~ x, data = df_infl)

Residuals:
   Min     1Q Median     3Q    Max 
-2.481 -0.626 -0.035  0.488  4.222 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   4.1787     0.0962    43.4   &lt;2e-16 ***
x             1.9007     0.0826    23.0   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.972 on 100 degrees of freedom
Multiple R-squared:  0.841, Adjusted R-squared:  0.839 
F-statistic:  529 on 1 and 100 DF,  p-value: &lt;2e-16</code></pre>
</div>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<p>A model fit to the data with the <br> high-influence value <strong>removed</strong>:</p>
<div style="font-size: 80%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_good)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_good ~ x, data = df_outl)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.4526 -0.5939  0.0037  0.5157  2.2888 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   4.1369     0.0874    47.3   &lt;2e-16 ***
x             1.9315     0.0749    25.8   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.878 on 99 degrees of freedom
Multiple R-squared:  0.87,  Adjusted R-squared:  0.869 
F-statistic:  664 on 1 and 99 DF,  p-value: &lt;2e-16</code></pre>
</div>
</div>
</div>
</div></div>
<p><br></p>
<div class="fragment">
<p>Even if we remove the data point, we still see a significant positive association between <strong>x</strong> and <strong>y</strong>.</p>
<p><strong><span class="math inline">\(\rightarrow\)</span> The high-influence point doesn’t affect our conclusions, so it’s not a major cause for concern.</strong></p>
</div>
</section>
<section id="sensitivity-analysis-example-2" class="slide level2">
<h2>Sensitivity analysis: Example 2</h2>
<p>Again, imagine we want to know whether there’s a significant positive association between <strong>x</strong> and <strong>y</strong>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-51-1.svg"></p>
</figure>
</div>
</div>
</div>
<div style="font-size: 80%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)  
 (Intercept)    0.395      0.259    1.53    0.130  
 x              0.448      0.211    2.12    0.036 *</code></pre>
</div>
</div>
</div>
</div><div class="column fragment" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-53-1.svg"></p>
</figure>
</div>
</div>
</div>
<div style="font-size: 80%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
 (Intercept)   0.2189     0.1804    1.21     0.23
 x            -0.0703     0.1547   -0.45     0.65</code></pre>
</div>
</div>
</div>
</div></div>
<p><br></p>
<div class="fragment">
<p><strong><span class="math inline">\(\rightarrow\)</span> The high-influence point DOES affect our conclusions, so it IS a major problem for our analysis.</strong></p>
</div>
<div class="hcenter fragment" style="font-size:125%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section></section>
<section>
<section id="diagnostics-to-run-on-the-data-1" class="title-slide slide level1 center" data-background-color="#BF1932">
<h1>Diagnostics to run on the data</h1>
<p><br></p>
<div class="columns">
<div class="column" style="font-size: 125%;">
<p>Diagnosing unusual properties of <br> individual data points <br> (aka “case diagnostics”):</p>
<ol type="1">
<li>Outlyingness</li>
<li>High leverage</li>
<li>High influence</li>
</ol>
</div><div class="column" style="font-size: 125%;">
<p>Diagnosing undesirable relationships <br> between predictors:</p>
<ol type="1">
<li>Multicollinearity</li>
</ol>
</div></div>
</section>
<section id="multicollinearity" class="slide level2">
<h2>Multicollinearity</h2>
<div class="r-stack">
<p><img data-src="figs/collinear1.svg" class="fragment" height="600"></p>
<p><img data-src="figs/collinear2.svg" class="fragment" height="600"></p>
<p><img data-src="figs/collinear3.svg" class="fragment" height="600"></p>
<p><img data-src="figs/collinear4.svg" class="fragment" height="600"></p>
</div>
<div class="fragment">
<p>When two predictors are correlated, they contain similar information.</p>
<p><strong>If you know one, you can guess the other.</strong></p>
<p>The model cannot tell which predictor is contributing what information, so its estimates are less precise. In other words, <strong>the variance of its estimates increases.</strong></p>
</div>
</section>
<section id="plotting-correlations-between-predictors" class="slide level2">
<h2>Plotting correlations between predictors</h2>
<p>We have a data set called <code>corr_df</code> with an outcome variable <code>y</code> and two predictors <code>x1</code> and <code>x2</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(corr_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-57-1.svg" class="quarto-figure quarto-figure-center r-stretch"><p>In <code>corr_df</code>, <strong><code>x1</code> and <code>x2</code> are highly correlated.</strong></p>
<p>The correlation appears as a strong diagonal line.</p>
</section>
<section id="plotting-correlations-between-predictors-1" class="slide level2">
<h2>Plotting correlations between predictors</h2>
<p>We have another data set called <code>uncorr_df</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(uncorr_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>

<img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-60-1.svg" class="quarto-figure quarto-figure-center r-stretch"><p>In <code>uncorr_df</code>, <strong><code>x1</code> and <code>x2</code> are not very correlated.</strong></p>
<p>The lack of correlation appears as a cloud of data points.</p>
</section>
<section id="diagnosing-multicollinearity" class="slide level2">
<h2>Diagnosing multicollinearity</h2>
<p><br></p>
<p>When predictors are correlated, the variance of the model’s estimates increases.</p>
<p>We can detect this using the <strong>Variance Inflation Factor</strong> or VIF.</p>
<ul>
<li>VIF measures <strong>how much the standard error of a predictor is increased by correlations with other predictors.</strong></li>
<li>More precisely: <span class="math inline">\(\sqrt{\text{VIF}}\)</span> = how many times larger the standard error (SE) of each predictor is, compared to a version of the model without the other predictors.</li>
</ul>
<p><br></p>
<div class="fragment">
<p>Intepreting VIF:</p>
<ul>
<li><strong>Below 5 is low,</strong> no need to worry.
<ul>
<li><span class="math inline">\(\sqrt{5} = 2.24\)</span>, so SE is 2.24 times bigger than it would be if we removed the correlated predictors.</li>
</ul></li>
<li><strong>Between 5 and 10 is moderate,</strong> a little worrying but OK.
<ul>
<li><span class="math inline">\(\sqrt{10} = 3.16\)</span>, so SE is 3.16 times bigger than it would be if we removed the correlated predictors.</li>
</ul></li>
<li><strong>More than 10 is big,</strong> cause for lots of concern.</li>
</ul>
</div>
</section>
<section id="vif-in-r" class="slide level2">
<h2>VIF in R</h2>
<p>We calculate the Variance Inflation Factor in R using <code>vif()</code> from the package <code>car</code>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Correlated predictors:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-61-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_corr <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> corr_df)</span>
<span id="cb48-2"><a href="" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(m_corr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> x1  x2 
7.4 7.4 </code></pre>
</div>
</div>
<p>The SE of each predictor is <span class="math inline">\(\sqrt{7.4} = 2.72\)</span> times bigger than it would be without the other predictors.</p>
<p>Slightly worrisome!</p>
</div><div class="column" style="width:50%;">
<p>Uncorrelated predictors:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-63-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="" aria-hidden="true" tabindex="-1"></a>m_uncorr <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> uncorr_df)</span>
<span id="cb50-2"><a href="" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(m_uncorr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>x1 x2 
 1  1 </code></pre>
</div>
</div>
<p>The SE of each predictor is <span class="math inline">\(\sqrt{1} = 1\)</span> times bigger—so no different at all.</p>
</div></div>
</section>
<section id="what-to-do-if-predictors-are-correlated" class="slide level2">
<h2>What to do if predictors are correlated</h2>
<p><br></p>
<p>In order of increasing spiciness:</p>
<p><br></p>
<div class="columns">
<div class="column" style="width:25%;">
<!-- lucide-lab--pepper-chilli.svg -->
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>If the correlation isn’t too worrying, then leave the model as-is and report the VIFs.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><strong><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></strong></p>
</div><div class="column" style="width:75%;">
<p>If the correlations are large, remove one of the correlated predictors from the model—it’s not adding any new information anyway.</p>
</div></div>
<div class="columns">
<div class="column" style="width:25%;">
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"> <img style="vertical-align: text-bottom; width: 2em;" src="figs/lucide-lab--pepper-chilli.svg"></p>
</div><div class="column" style="width:75%;">
<p>In DAPR3: Make a composite predictor that combines the correlated predictors. For example: a sum, an average, or a cleverer technique like Principal Component Analysis.</p>
</div></div>
<div class="hcenter fragment" style="font-size:125%;">
<p><br></p>
<p><img style="vertical-align: text-bottom; width: 2em;" src="figs/mdi--frequently-asked-questions.svg"></p>
</div>
</section>
<section id="check-lots-but-not-all-using-check_model" class="slide level2">
<h2>Check lots (but not all) using <code>check_model()</code></h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:40%;">
<p>A few assumption/diagnostic checks are packaged together by <code>check_model(model)</code> from the <code>performance</code> package.</p>
<p>You’ll play with <code>check_model()</code> in the lab.</p>
<p><br></p>
<p><strong>Note: <code>check_model()</code> is only a partial shortcut.</strong></p>
<p>It leaves out a lot of important checks too.</p>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(m_corr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="dapr2_08_assump_diag_files/figure-revealjs/unnamed-chunk-65-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="building-an-analysis-workflow" class="slide level2">
<h2>Building an analysis workflow</h2>
<p><br></p>
<div class="r-stack">
<p><img data-src="figs/block2-flowchart-08-0.svg" class="fragment" height="550"></p>
<p><img data-src="figs/block2-flowchart-08-1.svg" class="fragment" height="550"></p>
<p><img data-src="figs/block2-flowchart-08-2.svg" class="fragment" height="550"></p>
<p><img data-src="figs/block2-flowchart-08-3.svg" class="fragment" height="550"></p>
</div>
</section>
<section id="revisiting-this-weeks-learning-objectives" class="slide level2">
<h2>Revisiting this week’s learning objectives</h2>
<div style="font-size: 125%;">
<div class="fragment">
<div class="dapr2callout">
<p><strong>What does a linear model assume is true about the data that it models? (Four assumptions)</strong></p>
<div style="font-size: 80%;">
<ul>
<li>Linearity: The association between predictor and outcome is a straight line.</li>
<li>Independence: Every data point is independent of every other data point.</li>
<li>Normally-distributed errors: The differences between fitted line and each data point (i.e., the residuals) follow a normal distribution.</li>
<li>Equal variance of errors: The differences between fitted line and each data point (i.e., the residuals) are dispersed by a similar amount across the whole range of the predictor.</li>
</ul>
</div>
</div>
</div>
<div class="fragment">
<div class="dapr2callout">
<p><strong>What three properties of a single data point might affect a linear model’s estimates? How can we diagnose each property?</strong></p>
<div style="font-size: 80%;">
<ul>
<li>Unusual outcome value, called “outlyingness”. Diagnose with studentised residuals.</li>
<li>Unusual predictor value, called “high leverage”. Diagnose with hat values.</li>
<li>Unusual outcome and/or predictor value, called “high influence”. Diagnose with Cook’s Distance and COVRATIO.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="revisiting-this-weeks-learning-objectives-1" class="slide level2">
<h2>Revisiting this week’s learning objectives</h2>
<div style="font-size: 125%;">
<div>
<div class="dapr2callout">
<p><strong>What relationship between predictors do we want to avoid? How can we diagnose it?</strong></p>
<div style="font-size: 80%;">
<ul>
<li>We want to avoid predictors being highly correlated with one another. If they are, we call the situation “multicollinearity”.</li>
<li>When predictors are highly correlated, they contain very similar information, so the model is very uncertain how each one individually is associated with the outcome.</li>
<li>Diagnose multicollinearity with the Variance Inflation Factor (VIF).</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="this-week" class="slide level2">
<h2>This week</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="tasks">Tasks</h3>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figs/labs.svg" style="width:15.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Attend your lab and work together on the exercises</strong></p>
</div><div class="column" style="width:50%;">
<h3 id="support">Support</h3>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figs/forum.svg" style="width:15.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Help each other on the Piazza forum</strong></p>
</div></div>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figs/exam.svg" style="width:15.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Complete the weekly quiz</strong></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figs/oh.png" style="width:15.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Attend office hours (see Learn page for details)</strong></p>
</div></div>
</section></section>
<section>
<section id="appendix" class="title-slide slide level1 appendix center" data-background-color="#BF1932" data-visibility="uncounted">
<h1>Appendix</h1>

</section>
<section id="hat-values-the-maths" class="slide level2" data-visibility="uncounted">
<h2>Hat values: The maths</h2>
<p><br></p>
<p><strong>Hat values</strong> ( <span class="math inline">\(h_i\)</span> ) are used to assess data points’ leverage in a linear model.</p>
<p>In essence: we find the difference between each data point and the mean. We standardise that difference with respect to how big <em>all</em> the differences are and with respect to how many data points we have overall.</p>
<p>For a simple linear model, the hat value for case <span class="math inline">\(i\)</span> would be</p>
<p><span class="math display">\[h_i = \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\sum_{i=1}^n(x_i - \bar{x})^2}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(n\)</span> is the sample size</li>
<li><span class="math inline">\((x_i - \bar{x})^2\)</span> is the squared deviation of the predictor value for that case, <span class="math inline">\(x_i\)</span>, from the mean <span class="math inline">\(\bar x\)</span></li>
<li><span class="math inline">\(\sum_{i=1}^n(x_i - \bar{x})^2\)</span> is the sum of all these squared deviations, for all cases</li>
</ul>
</section>
<section id="hat-values-the-maths-1" class="slide level2" data-visibility="uncounted">
<h2>Hat values: The maths</h2>
<p><br></p>
<p>The mean of all hat values ( <span class="math inline">\(\bar{h}\)</span> ) is:</p>
<p><span class="math display">\[\bar{h} = (k+1)/n\]</span></p>
<ul>
<li><span class="math inline">\(k\)</span> is the number of predictors</li>
<li><span class="math inline">\(n\)</span> is the sample size</li>
</ul>
<p>In a simple linear regression with one predictor, <span class="math inline">\(k=1\)</span>.</p>
<p>So <span class="math inline">\(\bar h = (1 + 1) / n = 2 /n\)</span>.</p>
</section>
<section id="cooks-distance-the-maths" class="slide level2" data-visibility="uncounted">
<h2>Cook’s Distance: The maths</h2>
<p><br></p>
<p><strong>Cook’s Distance</strong> of a data point <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[D_i = \frac{(\text{StandardizedResidual}_i)^2}{k+1} \times \frac{h_i}{1-h_i}\]</span></p>
<p>Where</p>
<p><span class="math display">\[\frac{(\text{StandardizedResidual}_i)^2}{k+1} = \text{Outlyingness}\]</span></p>
<p>and</p>
<p><span class="math display">\[\frac{h_i}{1-h_i} = \text{Leverage},\]</span></p>
<p>So</p>
<p><span class="math display">\[D_i = \text{Outlyingness} \times \text{Leverage}.\]</span></p>
<!-- :::: {.columns} -->
<!-- ::: {.column width="50%"} -->
<!-- a -->
<!-- ::: -->
<!-- ::: {.column width="50%"} -->
<!-- b -->
<!-- ::: -->
<!-- :::: -->
<!-- style="font-size: 125;" -->
<!--  -->

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/reveal-attribution/attribution.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="dapr2_08_assump_diag_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1294,

        height: 1000,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, RevealAttribution, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <style>
      .hide {
        display: none !important;
      }
    </style>


    <script>
      function remove() {
        let footer = document.querySelector('div.footer');
        let slideNo = document.querySelector('div.slide-number');
        slideNo.classList.add('hide');
        footer.classList.add('hide');
      
        Reveal.on('slidechanged', event => {  
          if(Reveal.isFirstSlide()) {
            slideNo.classList.add('hide');
            footer.classList.add('hide');
          } else {
            slideNo.classList.remove('hide');
            footer.classList.remove('hide');
          }
        });
      }
      
      window.onload = remove();
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>
<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title> Introduction to Power Analysis </title>
    <meta charset="utf-8" />
    <meta name="author" content="dapR2 Team" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <b> Introduction to Power Analysis </b>
## Data Analysis for Psychology in R 2<br><br>
### dapR2 Team
### Department of Psychology<br>The University of Edinburgh

---







# Weeks Learning Objectives

- Recap the concept of statistical power

- Introduce power analysis for study planning

- Differentiate analytic from simulation based power calculations

- Introduce R tools for both analytic and simulation power calculations

---
# What is power?

&lt;img src="figs/ht-errors-table-2.png" width="80%" /&gt;

---
# What is power?
- Power depends on:
  - Sample size
  - Effect size (i.e. an alternative hypothesis)
  - Significance level ( `\(\alpha\)` )

---
# Power and sample size
- In planning, power analysis often boils down to understanding what sample size is big enough for a study.

- What is big enough?
  - It depends! 
  - On the study design, the sample characteristics, the expected effect size, the desired level of precision, the costs and benefits of different resultsâ€¦

- Power analysis can help us to work out how much data we should collect for our studies.

---
# Why is power important?

- So you don't waste your time.

- So you don't waste other people's time.

- So you can answer the question(s) you're interested in.


---
# Analytic power analysis

- Analytical solutions essentially just take known numbers; 
  - `\(\alpha\)`, 
  - power, 
  - n, and 
  - effect size 

- ...and solve for an unknown number
  - These four variables relate to each other in a way that means each one *"is a function of the other three"* (Cohen, 1992, p. 156).

---
# Analytic power analysis

- If you have an... 
  - effect size of interest, a chosen alpha level and a planned sample size 
  - you can calculate the statistical power of your planned study.

- If you have an... 
  - effect size of interest, a chosen alpha level and a chosen statistical power level 
  - you can calculate the required sample size of your planned study.

---
# Power by simulation
- For complex designs, simulation can be used to estimate power. 

- If enough simulations are conducted, simulation-based estimates of power will approximate estimates of power from analytical solutions.

- Why is it needed?
  - sometimes the analytic solutions are not accurate
  - sometimes there is no analytic power solution

---
# The power of what?
- People commonly talk about underpowered studies. 
  - This is a little misleading.

- What we are conducting our power analysis on, is a particular combination of design, statistical test, and effect size.
  - yes, these are elements of the study, but it is not *the* study itself.

- Read more [here](https://towardsdatascience.com/why-you-shouldnt-say-this-study-is-underpowered-627f002ddf35) 

---
# Post-hoc power
- Often researchers are asked to calculate power **after they have collected data**. 
  - This is referred to as post-hoc or observed power analysis.
  - Here we do not use an anticipated effect size, but the effect size you observed from your data.

- This is generally not a meaningful thing to do.

- Consider a definition of power (bold added):

&gt; "The power of a test to detect a correct alternative hypothesis is the **pre-study probability** that the test will reject the test hypothesis (e.g., the probability that P will not exceed a pre-specified cut-off such as 0.05)." (Greenland et al., 2016, p. 345)

- Read more [here](http://daniellakens.blogspot.com/2014/12/observed-power-and-what-to-do-if-your.html)

---
# Conventions
- Conventionally, alpha is fixed, most commonly at .05. 

- A common conventional value for power is .8.

- However, both of these conventions are arbitrary cut-offs on continuous scales.

- As such, sometimes researchers will calculate power curves
  - These show, for example, the power giving an increasing N, fixed `\(\alpha\)` and fixed effect size.

- It is important to justify your decisions, including the alpha., effect size and power levels you choose (see Lakens et al., 2017).
  - Although much like with the discussion of `\(p\)`-values, this can sometimes be tricky.
  - Effect size we often have better handle on based on previous studies
  - Though estimates in the literature are often inflated.


---
class: center, middle
# Questions


---
# Analytic power in R
- We will look at three examples of applying analytic power in R based on the `pwr` package

1. independent samples t-test
2. correlation
3. F-test from linear models

- We will do our t-test as a fully worked example
  - and then look more briefly at the functions for correlation and linear models.

---
# Analytic power in R
- Let's use an an independent samples t-test. 

- In our imaginary study, we will compare the high striker scores of two population-representative groups: 
  - one that has not undergone any training and 
  - one that has taken an intensive day-long high striker training course. 

- We hypothesise that the training group will have higher scores.

---
# Analytic power in R
- To begin, let's work with typical sample and effect sizes. 

- The median total sample size across four APA journals in 2006 was 40 (Marsazalek, Barber, Kohlhart, &amp; Holmes, 2011, Table 1). 

- A Cohen's d effect size of 0.5 has been considered a medium effect size (Cohen, 1992, Table 1). We can plug these values in and work out what our statistical power would be with them if we use the conventional alpha level of .05.

- We will use the `pwr` package.



```r
library(pwr)
pwr.t.test(n = 20, 
           d = 0.5, 
           sig.level = .05, 
           type= "two.sample", 
           alternative = "two.sided")
```

---
# Analytic power in R


```r
pwr.t.test(n = 20,d = 0.5, sig.level = .05, 
           type= "two.sample", alternative = "two.sided")
```

```
## 
##      Two-sample t test power calculation 
## 
##               n = 20
##               d = 0.5
##       sig.level = 0.05
##           power = 0.337939
##     alternative = two.sided
## 
## NOTE: n is number in *each* group
```

- Our power is only .34! 

- So if there is a true standardised effect of .5 in the population, studies with 20 participants per group should only expect to reject the null hypothesis about 34% of the time.

---
# Analytic power in R
- But this wasn't the appropriate power analysis. 
  - We have a directional hypothesis.
  - we think they will score *higher* than the non-training group. 


```r
pwr.t.test(n = 20, d = 0.5, sig.level = .05, type= "two.sample", 
*          alternative = "greater")
```

```
## 
##      Two-sample t test power calculation 
## 
##               n = 20
##               d = 0.5
##       sig.level = 0.05
##           power = 0.4633743
##     alternative = greater
## 
## NOTE: n is number in *each* group
```

- Our power for a one-sided test is about .46. 

---
# Analytic power in R
- Instead of computing the power given a sample size of 20 participants per group, let's set the level of power.


```r
*pwr.t.test(power = 0.95,
           d = 0.5, 
           sig.level = .05, 
           type= "two.sample", 
           alternative = "greater")
```

```
## 
##      Two-sample t test power calculation 
## 
##               n = 87.26261
##               d = 0.5
##       sig.level = 0.05
##           power = 0.95
##     alternative = greater
## 
## NOTE: n is number in *each* group
```

- We would need to collect 88 participants per group to have 95% power for an effect size of 0.5.

---
# Analytic power in R
- What if we wanted to change `\(\alpha\)` ?
  - Some have argued for a change in `\(\alpha\)` norms to .005 (Benjamin et al., 2017). 
  - How many participants would we need for the same design if we used an alpha of .005?


```r
pwr.t.test(power = 0.95, d = 0.5, 
*          sig.level = .005,
           type= "two.sample", alternative = "greater")
```

```
## 
##      Two-sample t test power calculation 
## 
##               n = 144.1827
##               d = 0.5
##       sig.level = 0.005
##           power = 0.95
##     alternative = greater
## 
## NOTE: n is number in *each* group
```

- We would need 145 participants if our alpha was to be .005.

---
# Analytic power in R

.pull-left[
- We can plot our power at different levels of N.


```r
res &lt;- pwr.t.test(power = 0.95, d = 0.5, 
           sig.level = .005,
           type= "two.sample", 
           alternative = "greater")

plot(res)
```
]

.pull-right[

![](dapr2_17_intropower_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

]

---
class: center, middle
# Questions.....

---
# `pwr` for correlation
+ To use `pwr` for correlations, we use the `pwr.r.test()` function


```r
pwr.r.test(n = ,
           r = ,
           sig.level = ,
           power = )
```

+ Here `r` is the effect size, and the other three arguments are as we have defined previously.


---
# `pwr` for correlation

+ Suppose we wanted to get the sample size to assess the association between the personality trait of Conscientiousness and performance at work.
  + The literature says this effect ranges but is ~ 0.15
  + I would 90% power and `\(\alpha\)` of 0.05
 

```r
pwr.r.test(r = 0.15,
           sig.level = .05,
           power = .90)
```

```
## 
##      approximate correlation power calculation (arctangh transformation) 
## 
##               n = 462.0711
##               r = 0.15
##       sig.level = 0.05
##           power = 0.9
##     alternative = two.sided
```

 
---
# `pwr` for F-tests
+ For linear models, we use `pwr.f2.test()`


```r
pwr.f2.test(u = , #numerator degrees of freedom (model)
            v = , #demoninator degrees of freedom (residual)
            f2 = , #stat to be calculated (below)
            sig.level = ,
            power = 
            )
```

+ `u` and `v` come from study design.
  + `u` = predictors in the model ( `\(k\)` ) 
  + `v` = n-k-1

+ There are two versions of `\(f^2\)`
  + these are specified as formula
  
  
---
# `pwr` for F-tests
+ The first is:

`$$f^2 = \frac{R^2}{1-R^2}$$`
+ This should be used when we want to see the overall power of a set of predictors
  + Think overall model `\(F\)`-test

+ For example, if we wanted sample size for an overall `\(R^2\)` of 0.10, with 5 predictors, power of 0.8 and `\(\alpha\)` = .05



```r
pwr.f2.test(u = 5, #numerator degrees of freedom (model)
            #v = , #demoninator degrees of freedom (residual)
            f2 = 0.10/(1-0.10), #stat to be calculated (below)
            sig.level = .05,
            power = .80
            )
```



---
# `pwr` for F-tests


```r
pwr.f2.test(u = 5, #numerator degrees of freedom (model)
            #v = , #demoninator degrees of freedom (residual)
            f2 = 0.10/(1-0.10), #stat to be calculated (below)
            sig.level = .05,
            power = .80
            )
```

```
## 
##      Multiple regression power calculation 
## 
##               u = 5
##               v = 115.1043
##              f2 = 0.1111111
##       sig.level = 0.05
##           power = 0.8
```

+ We need a sample of ~121 (115 + 5 + 1)

---
# `pwr` for F-tests
+ The second is:

`$$f^2 = \frac{R^2_{AB} - R^2_{A}}{1-R^2_{AB}}$$`

+ This is the power for the incremental-F or the difference between a restricted ( `\(R^2_A\)` ) and a full ( `\(R^2_{AB}\)` ) model.

+ For example, if we wanted sample size for a difference between 0.10 and 0.15, for the addition of 3 predictors, power of 0.8 and `\(\alpha\)` = .05



```r
pwr.f2.test(u = 3, #numerator degrees of freedom (model)
            #v = , #demoninator degrees of freedom (residual)
            f2 = (0.15 - 0.10)/(1-0.20), #stat to be calculated (below)
            sig.level = .05,
            power = .80
            )
```


---
# `pwr` for F-tests


```r
pwr.f2.test(u = 3, #numerator degrees of freedom (model)
            #v = , #demoninator degrees of freedom (residual)
            f2 = (0.15 - 0.10)/(1-0.20), #stat to be calculated (below)
            sig.level = .05,
            power = .80
            )
```

```
## 
##      Multiple regression power calculation 
## 
##               u = 3
##               v = 174.3971
##              f2 = 0.0625
##       sig.level = 0.05
##           power = 0.8
```

+ We need a sample of ~180 (174.4 + 5 + 1)

---
class: center, middle
# Questions.....

---
# Power by sim
- We are primarily showing you how to use the `pwr` functions for common tests.
  - These are analytic calculations for power.
  - They are going to cover a lot of situations you will encounter in dissertations.

- But sometimes we need to estimate power a different way.

- Here we will briefly flag two packages that can be used for power by simulation.


---
# Power by sim in R (`paramtest`)
- To use `paramtest` we define a function that...
  - simulates data that is consistent with our model
  - runs the associated statistical test on each of these data sets.

- We then use the `paramtest` functions to run the simulation.

---
# Power by sim in R (`paramtest`)


```r
t_func &lt;- function(simNum, N, d) { # simNum is the number of simulations we want
    x1 &lt;- rnorm(N, 0, 1)           # N is the number of participants in each group
    x2 &lt;- rnorm(N, d, 1)           # d is the expected effect size
    t &lt;- t.test(x1, x2, var.equal=TRUE) # runs t-tests on the simulated datasets
    stat &lt;- t$statistic # extracts t-values from the t-tests
    p &lt;- t$p.value # extracts p-values from the t-tests
    return(c(t = stat, p = p, sig = (p &lt; .05)))
}
```

---
# Power by sim in R (`paramtest`)


```r
head(results(power_ttest &lt;- run_test(
  t_func, n.iter = 1000, output = 'data.frame', N = 20, d = 0.5)))
```

```
## Running 1,000 tests...
```

```
##   iter        t.t            p sig
## 1    1 -1.1074220 0.2750724021   0
## 2    2 -3.6214042 0.0008527424   1
## 3    3 -0.3833141 0.7036229881   0
## 4    4 -0.6929828 0.4925342245   0
## 5    5 -1.1905301 0.2412224184   0
## 6    6 -1.9171999 0.0627535155   0
```

- We now have the t-values and p-values from our simulation, along with a binary indicator of whether a significant p-value was produced.

---
# Power by sim in R (`paramtest`)


```r
table(power_ttest$results$sig)/1000
```

```
## 
##     0     1 
## 0.657 0.343
```

- The proportion of significant results is our simulation-based estimate of power. 
- Here, even with only 1000 iterations, the power estimate from simulation is similar to the one obtained analytically.

---
# Power by sim in R (`WebPower`)

- I want to do no more than tell you `WebPower` exists.
  - See [here](https://webpower.psychstat.org/wiki/)

- There is an R package that does all of the simple analytic tests
  - It also does more complex simulation methods
  - And there is an online (non-R) variant for complex models.


---
# Summary of today

- Power analysis is an important step in study design
  - But post-hoc power is meaningless

- For simple models, we can make use of the `pwr._` functions for analytic solutions
  - To do so we need to know `\(\alpha\)` , power, and effect size

- For complex models, we can estimate power by simulation.
  - To do so we need ....

- Both can be done in R.


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>

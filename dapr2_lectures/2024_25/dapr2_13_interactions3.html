<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title> Interactions 3 </title>
    <meta charset="utf-8" />
    <meta name="author" content="dapR2 Team" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# <b> Interactions 3 </b>
]
.subtitle[
## Data Analysis for Psychology in R 2<br><br>
]
.author[
### dapR2 Team
]
.institute[
### Department of Psychology<br>The University of Edinburgh
]

---








# Course Overview

.pull-left[

&lt;!---
I've just copied the output of the Sem 1 table here and removed the bolding on the last week, so things look consistent with the trailing opacity produced by the course_table.R script otherwise.
--&gt;


&lt;table style="border: 1px solid black;&gt;
  &lt;tr style="padding: 0 1em 0 1em;"&gt;
    &lt;td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle"&gt;
        &lt;b&gt;Introduction to Linear Models&lt;/b&gt;&lt;/td&gt;
    &lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Intro to Linear Regression&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Interpreting Linear Models&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Testing Individual Predictors&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Model Testing &amp; Comparison&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Linear Model Analysis&lt;/td&gt;&lt;/tr&gt;

  &lt;tr style="padding: 0 1em 0 1em;"&gt;
    &lt;td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle"&gt;
        &lt;b&gt;Analysing Experimental Studies&lt;/b&gt;&lt;/td&gt;
    &lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Categorical Predictors &amp; Dummy Coding&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        	Effects Coding &amp; Coding Specific Contrasts&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Assumptions &amp; Diagnostics&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Bootstrapping&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Categorical Predictor Analysis&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;



]

.pull-right[


&lt;table style="border: 1px solid black;&gt;
  &lt;tr style="padding: 0 1em 0 1em;"&gt;
    &lt;td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1;text-align:center;vertical-align: middle"&gt;
        &lt;b&gt;Interactions&lt;/b&gt;&lt;/td&gt;
    &lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Interactions I&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        Interactions II&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:1"&gt;
        &lt;b&gt;Interactions III&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Analysing Experiments&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Interaction Analysis&lt;/td&gt;&lt;/tr&gt;

  &lt;tr style="padding: 0 1em 0 1em;"&gt;
    &lt;td rowspan="5" style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4;text-align:center;vertical-align: middle"&gt;
        &lt;b&gt;Advanced Topics&lt;/b&gt;&lt;/td&gt;
    &lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Power Analysis&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Binary Logistic Regression I&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Binary Logistic Regression II&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        Logistic Regresison Analysis&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td style="border: 1px solid black;padding: 0 1em 0 1em;opacity:0.4"&gt;
        	Exam Prep and Course Q&amp;A&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;


]


---


# Week's Learning Objectives

1. Interpret interactions between two categorical variables (with dummy coding)
  + Begin with 2x2 (two binary variables)
  + Move on to look at examples with more levels

2. Visualise and probe interactions

3. Be able to read interaction plots

---
#  General definition 

+ When the effects of one predictor on the outcome differ across levels of another predictor

+ Categorical `\(\times\)` categorical interaction:
	+ There is a difference in the differences between groups across levels of a second factor

+ This idea of a difference in differences can be quite tricky to think about
  + So we will start with some visualisation, and then look at two examples

---
# Visualising interactions
+ In our class example we have looked at predicting salary from years of service (a continous variable) and department (a categorical variable)

+ Suppose our company also had two sites, Edinburgh and Dundee, and we wanted to see if the salaries across departments differed depending on location

+ The table below contains hypothetical average salaries in thousands of pounds for each group


|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |        50|     40|
|Manager  |        30|     20|

---
# Basic plot

.pull-left[



|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |        50|     40|
|Manager  |        30|     20|

+ Let's look at the plot:
  + x-axis shows locations
  + y-axis is our salaries
  + The colours represent departments
  
]

.pull-right[

![](dapr2_13_interactions3_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;
]


---
# Difference in differences (1)


.pull-left[




|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |        50|     40|
|Manager  |        30|     20|

+ In each plot we look at, think about subtracting the average store managers salary (blue triangle) from the average accounts salary (red circle)

+ For both Edinburgh and Dundee, this difference is £20,000

+ Note, the lines are parallel
  + When the lines are parallel, there is no interaction
  + The effect of one variable (department) does not vary along values or levels of the other variable (location)

]


.pull-right[

![](dapr2_13_interactions3_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

]


---
# Difference in differences (2)


.pull-left[

Let's imagine our group means look like this instead: 




|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |        50|     40|
|Manager  |        40|     20|

+ This time we can see the difference differs
  + £20,000 in Dundee
  + £10,000 in Edinburgh
  
+ Note the lines are no longer parallel
  + Suggests interaction
  + But not crossing (so ordinal interaction)

]

.pull-right[

![](dapr2_13_interactions3_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

]

---
# Difference in differences (3)

.pull-left[

Now consider the following group means:




|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |        40|     40|
|Manager  |        60|     20|

+ This time we can see the difference differs
  + postive difference of £20,000 in Dundee
  + negative difference of £20,000 in Edinburgh
  
+ Note the lines are no longer parallel
  + Suggests interaction
  + Now crossing (so disordinal interaction)

]

.pull-right[

![](dapr2_13_interactions3_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

]

---
class: center, middle
# Questions?


---
#  Lecture notation 

`$$y_i = \beta_0 + \beta_1 x_{i} + \beta_2 z_{i} + \beta_3 x_{i}z_{i} + \epsilon_i$$`

+ Lecture notation:
  + `\(y\)` is a continuous outcome
  
  + `\(x\)` is a categorical predictor ( `location` )
  
  + `\(z\)` is a categorical predictor (`department` )
  
  + `\(xz\)` is their product, or interaction predictor
  
---
# Product for dummy variables

+ Let's set Edinburgh as the baseline for `location` and Accounts as the baseline for `department`
+ The interaction is the product of the two variables
+ We can then figure out what to substitute for `\(x\)`, `\(z\)` and `\(xz\)` in our regression formula to get predictions for each group once we have estimated our `\(\beta\)` coefficients



|location  |department |  x|  z| xz|
|:---------|:----------|--:|--:|--:|
|Edinburgh |Accounts   |  0|  0|  0|
|Edinburgh |Manager    |  0|  1|  0|
|Dundee    |Accounts   |  1|  0|  0|
|Dundee    |Manager    |  1|  1|  1|

---
#  Interpretation: Categorical `\(\times\)` categorical interaction (dummy codes)

`$$y_i = \beta_0 + \beta_1 x_{i} + \beta_2 z_{i} + \beta_3 x_{i}z_{i} + \epsilon_i$$`

+ `\(\beta_0\)` = Value of `\(y\)` when `\(x\)` and `\(z\)` are 0

+ Expected salary for Accounts in Edinburgh


---
#  Interpretation: Categorical `\(\times\)` categorical interaction (dummy codes)

`$$y_i = \beta_0 + \beta_1 x_{i} + \beta_2 z_{i} + \beta_3 x_{i}z_{i} + \epsilon_i$$`

+ Remember `\(x\)` is our `location` variable and `\(z\)` is our `department` variable

+ `\(\beta_1\)` = Difference between levels of `\(x\)` when `\(z\)` = 0

+ The difference in salary between Accounts in Edinburgh and Dundee


---
#  Interpretation: Categorical `\(\times\)` categorical interaction (dummy codes)

`$$y_i = \beta_0 + \beta_1 x_{i} + \beta_2 z_{i} + \beta_3 x_{i}z_{i} + \epsilon_i$$`

+ Remember `\(x\)` is our `location` variable and `\(z\)` is our `department` variable

+ `\(\beta_2\)` = Difference between levels of `\(z\)` when `\(x\)` = 0

+ The difference in salary between Accounts and Store managers in Edinburgh


---
#  Interpretation: Categorical `\(\times\)` categorical interaction (dummy codes)

`$$y_i = \beta_0 + \beta_1 x_{i} + \beta_2 z_{i} + \beta_3 x_{i}z_{i} + \epsilon_i$$`

+  `\(\beta_3\)` = Difference between levels of `\(x\)` across levels of `\(z\)`

+ The difference between salary in Accounts and Store managers between Edinburgh and Dundee

+ "Difference in differences"

---
#  Example: Categorical `\(\times\)` categorical

.pull-left[

Let's examine the actual group means in our data set


``` r
salary3 %&gt;%
  group_by(location, department) %&gt;%
  summarise(
    Salary = mean(salary)
  )
```
]

.pull-right[

```
## # A tibble: 4 × 3
## # Groups:   location [2]
##   location  department Salary
##   &lt;fct&gt;     &lt;fct&gt;       &lt;dbl&gt;
## 1 Edinburgh Accounts     50.7
## 2 Edinburgh Manager      47.2
## 3 Dundee    Accounts     48.7
## 4 Dundee    Manager      36.8
```
]

---
#  Example: Categorical `\(\times\)` categorical

``` r
m1 &lt;- lm(salary ~ location*department, salary3)
```


```
## 
## Call:
## lm(formula = salary ~ location * department, data = salary3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.551  -3.389   0.579   2.937  14.325 
## 
## Coefficients:
##                                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                       50.6704     0.7144  70.927  &lt; 2e-16 ***
## locationDundee                    -1.9796     1.4872  -1.331 0.186297    
## departmentManager                 -3.4625     1.3365  -2.591 0.011072 *  
## locationDundee:departmentManager  -8.4153     2.2779  -3.694 0.000367 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 5.052 on 96 degrees of freedom
## Multiple R-squared:  0.4774,	Adjusted R-squared:  0.461 
## F-statistic: 29.23 on 3 and 96 DF,  p-value: 1.636e-13
```

---
#  Example: Categorical `\(\times\)` categorical

.pull-left[

+ We can visualise categorical interactions using `cat_plot()` from the `interactions` package 

+ `probe_interaction()` does not work with two categorical predictors


``` r
cat_plot(m1,
         pred = location,
         modx = department)
```

+ Plot shows group means and 95% confidence intervals based on `m1`

]

.pull-right[
![](dapr2_13_interactions3_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

]


---
#  Example: Categorical `\(\times\)` categorical

```
##                                  Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                         50.67       0.71   70.93     0.00
## locationDundee                      -1.98       1.49   -1.33     0.19
## departmentManager                   -3.46       1.34   -2.59     0.01
## locationDundee:departmentManager    -8.42       2.28   -3.69     0.00
```

.pull-left[
+ `\(\beta_0\)` = Value of `\(y\)` when `\(x\)` and `\(z\)` are 0

+ Expected salary for Accounts in Edinburgh is £50,670
]


.pull-right[

|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |     50.67|  48.69|
|Manager  |     47.21|  36.81|
]

---
#  Example: Categorical `\(\times\)` categorical

```
##                                  Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                         50.67       0.71   70.93     0.00
## locationDundee                      -1.98       1.49   -1.33     0.19
## departmentManager                   -3.46       1.34   -2.59     0.01
## locationDundee:departmentManager    -8.42       2.28   -3.69     0.00
```

.pull-left[
+ `\(\beta_1\)` = Difference between levels of `\(x\)` when `\(z\)` = 0

+ The difference in salary between Accounts in Edinburgh and Dundee is £1,980. The salary is lower in Dundee. (But note this is not statistically significant)

+ With dummy coding, slopes for marginal effects refer to `\(\text{Group} - \text{Reference group (intercept)}\)`

]


.pull-right[

|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |     50.67|  48.69|
|Manager  |     47.21|  36.81|
]


---
#  Example: Categorical `\(\times\)` categorical

```
##                                  Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                         50.67       0.71   70.93     0.00
## locationDundee                      -1.98       1.49   -1.33     0.19
## departmentManager                   -3.46       1.34   -2.59     0.01
## locationDundee:departmentManager    -8.42       2.28   -3.69     0.00
```

.pull-left[
+ `\(\beta_2\)` = Difference between levels of `\(z\)` when `\(x\)` = 0

+ The difference in salary between Accounts and Store managers in Edinburgh is £3,460. The salary is lower for Store Managers.

+ With dummy coding, slopes for marginal effects refer to `\(\text{Group} - \text{Reference group (intercept)}\)`

]


.pull-right[

|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |     50.67|  48.69|
|Manager  |     47.21|  36.81|
]

---
#  Example: Categorical `\(\times\)` categorical

```
##                                  Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                         50.67       0.71   70.93     0.00
## locationDundee                      -1.98       1.49   -1.33     0.19
## departmentManager                   -3.46       1.34   -2.59     0.01
## locationDundee:departmentManager    -8.42       2.28   -3.69     0.00
```

.pull-left[
+  `\(\beta_3\)` = Difference between levels of `\(x\)` across levels of `\(z\)`

+ The difference between salary for Accounts and Store managers differs by £8,420 between Edinburgh and Dundee. The difference is greater in Dundee than in Edinburgh.

]


.pull-right[

|         | Edinburgh| Dundee|
|:--------|---------:|------:|
|Accounts |     50.67|  48.69|
|Manager  |     47.21|  36.81|
]

---
# Predictions from the regression formula

+ Let's plug our `\(\beta\)` coefficients back into our regression formula:

`$$\hat{y} = \beta_0 + \beta_1 x + \beta_2 z + \beta_3 xz$$`

`$$\hat{y} = 50.67 -1.98 x -3.46 z -8.42 xz$$`

&gt; **Test yourself: What is the estimated mean salary for each group?**

&lt;br&gt;


|location  |department |  x|  z| xz|
|:---------|:----------|--:|--:|--:|
|Edinburgh |Accounts   |  0|  0|  0|
|Edinburgh |Manager    |  0|  1|  0|
|Dundee    |Accounts   |  1|  0|  0|
|Dundee    |Manager    |  1|  1|  1|




---
class: center, middle
# Questions?

---
# Extending past 2x2

+ When fitting an interaction to categorical variables with more than 2 levels, we need additional interaction terms

+ Remember, a categorical variable with 3 levels is represented by the model as 2 binary variables
  + So that means we have two variables to create products with

+ The general rule on the number of interaction terms is:

`$$(r-1) \times (c-1)$$`

+ Where 
  + `\(r\)` (row) = number of levels of the first categorical variable
  + `\(c\)` (column) = number of levels of the second categorical variable


---
# Example

+ The data comes from a study into patient care in paediatric wards

+ A researcher was interested in whether the subjective well-being of patients differed dependent on the post-operation treatment schedule they were given, and the hospital in which they were staying

+ **Factor 1**: `Treatment` (Levels: TreatA, TreatB, TreatC).
  
+ **Factor 2**: `Hosp` (Levels: Hosp1, Hosp2). 
  
+ Total sample n = 180 (30 patients in each of 6 groups)
  + Between-person design 

+ **Outcome variable**: Subjective well-being (SWB)
  + An average of multiple raters (the patient, a member of their family, and a friend)
  + SWB scores ranged from 0 to 20


---
# The data




``` r
head(hosp_tbl, 10)
```

```
## # A tibble: 10 × 3
##      SWB Treatment Hospital
##    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;   
##  1   6.2 TreatA    Hosp1   
##  2  15.9 TreatA    Hosp1   
##  3   7.2 TreatA    Hosp1   
##  4  11.3 TreatA    Hosp1   
##  5  11.2 TreatA    Hosp1   
##  6   9   TreatA    Hosp1   
##  7  14.5 TreatA    Hosp1   
##  8   7.3 TreatA    Hosp1   
##  9  13.7 TreatA    Hosp1   
## 10  12.6 TreatA    Hosp1
```

---
# The group means

&lt;br&gt;


|       |Hosp1 |Hosp2 |
|:------|:-----|:-----|
|TreatA |10.80 |7.85  |
|TreatB |9.43  |13.11 |
|TreatC |10.10 |7.98  |

--

Some ways of phrasing our research question:

+ Is there a difference in how subjective wellbeing varies for the three different treatment options between the two hospitals?
+ Does the hospital a patient stays at influence how the type of treatment influences their subjective wellbeing?

---
# Model equations and coding

`$$y_{ijk} = b_0 + \underbrace{(b_1D_1 + b_2D_2)}_{\text{Treatment}} + \underbrace{b_3D_3}_{\text{Hospital}} + \underbrace{b_4D_{13} + b_5D_{23}}_{\text{Interactions}} + \epsilon_{i}$$`



```
## # A tibble: 6 × 7
##   Treatment Hospital    D1    D2    D3   D13   D23
##   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         Hosp1        0     0     0     0     0
## 2 A         Hosp2        0     0     1     0     0
## 3 B         Hosp1        1     0     0     0     0
## 4 B         Hosp2        1     0     1     1     0
## 5 C         Hosp1        0     1     0     0     0
## 6 C         Hosp2        0     1     1     0     1
```

&lt;br&gt;

+ Note that "D" stands for dummy-coded variables

---
# Interpretation with dummy coding

`$$y_{ijk} = b_0 + \underbrace{(b_1D_1 + b_2D_2)}_{\text{Treatment}} + \underbrace{b_3D_3}_{\text{Hospital}} + \underbrace{b_4D_{13} + b_5D_{23}}_{\text{Interactions}} + \epsilon_{i}$$`

+ Treatment A and Hospital 1 as reference levels


+ `\(b_0\)` = Mean of treatment A in hospital 1
+ `\(b_1\)` = Difference between Treatment B and Treatment A in Hospital 1
+ `\(b_2\)` = Difference between Treatment C and Treatment A in Hospital 1
+ `\(b_3\)` = Difference between Treatment A in Hospital 1 and Hospital 2
+ `\(b_4\)` = Difference between Treatment A and Treatment B between Hospital 1 and Hospital 2
+ `\(b_5\)` = Difference between Treatment A and Treatment C between Hospital 1 and Hospital 2


---
# Our results


``` r
m4 &lt;- lm(SWB ~ Treatment + Hospital + Treatment*Hospital, data = hosp_tbl)
m4sum &lt;- summary(m4)
m4res &lt;- round(m4sum$coefficients,2)
m4res
```

```
##                               Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                      10.80       0.37   29.19     0.00
## TreatmentTreatB                  -1.37       0.52   -2.62     0.01
## TreatmentTreatC                  -0.70       0.52   -1.33     0.18
## HospitalHosp2                    -2.95       0.52   -5.63     0.00
## TreatmentTreatB:HospitalHosp2     6.63       0.74    8.97     0.00
## TreatmentTreatC:HospitalHosp2     0.82       0.74    1.11     0.27
```

---
# Interpretation with dummy coding


```
##                               Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)                      10.80       0.37   29.19     0.00
## TreatmentTreatB                  -1.37       0.52   -2.62     0.01
## TreatmentTreatC                  -0.70       0.52   -1.33     0.18
## HospitalHosp2                    -2.95       0.52   -5.63     0.00
## TreatmentTreatB:HospitalHosp2     6.63       0.74    8.97     0.00
## TreatmentTreatC:HospitalHosp2     0.82       0.74    1.11     0.27
```

.pull-left[
+ `\(b_0\)` = Mean of treatment A in hospital 1
+ `\(b_1\)` = Difference between Treatment B and Treatment A in Hospital 1
+ `\(b_2\)` = Difference between Treatment C and Treatment A in Hospital 1
+ `\(b_3\)` = Difference between Treatment A in Hospital 1 and Hospital 2
+ `\(b_4\)` = Difference between Treatment A and Treatment B between Hospital 1 and Hospital 2
+ `\(b_5\)` = Difference between Treatment A and Treatment C between Hospital 1 and Hospital 2
]

.pull-right[

|       |Hosp1 |Hosp2 |
|:------|:-----|:-----|
|TreatA |10.80 |7.85  |
|TreatB |9.43  |13.11 |
|TreatC |10.10 |7.98  |

]
---
# Brief comment: 3-way interactions

+ **In principle** we can extend interactions to more than two variables

+ Consider our salary example:
  + We could ask: Are there location-based differences in how years of service contribute to salary differently across departments? 
  
+ Note that we'd then have three interacting predictors:
  + Years of service (continuous)
  + Department (binary; Store Manager, Accounts)
  + Location (binary; Edinburgh, Dundee)

+ This is a plausible question concerning organisatonal fairness

---
# Brief comment: 3-way interactions

+ In general, three-way interactions are tricky to interpret

+ Require lots of data to test as the effects are often very small
  + Extends the issues of power already discussed

+ **Only test a three-way interaction if you have strong theoretical reason for doing so**

---
# Summary

+ We have considered how we fit and interpret linear models with categorical interactions

+ We have focused on dummy coded variables (we'll return to effects coding next week)

+ We saw an example of an interaction involving categorical variables with more than two levels (multiple interaction terms)

---

## This week 

.pull-left[

### Tasks

&lt;img src="figs/labs.svg" width="10%" /&gt;

**Attend your lab and work together on the exercises** 

&lt;br&gt;

&lt;img src="figs/exam.svg" width="10%" /&gt;

**Complete the weekly quiz**

]

.pull-right[

### Support

&lt;img src="figs/forum.svg" width="10%" /&gt;

**Help each other on the Piazza forum**

&lt;br&gt;

&lt;img src="figs/oh.png" width="10%" /&gt;

**Attend office hours (see Learn page for details)**

]


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
